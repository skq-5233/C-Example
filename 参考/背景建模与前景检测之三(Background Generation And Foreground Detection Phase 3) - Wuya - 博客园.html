<!DOCTYPE html>
<!-- saved from url=(0102)http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html -->
<html lang="zh-cn"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script src="./背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园_files/ca-pub-4210569241504288.js"></script><script async="" src="./背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园_files/analytics.js"></script><script type="text/javascript" src="./背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园_files/encoder.js"></script>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园</title>
<link type="text/css" rel="stylesheet" href="./背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园_files/blog-common.css">
<link id="MainCss" type="text/css" rel="stylesheet" href="./背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园_files/bundle-SimpleBlue.css">
<link id="mobile-style" media="only screen and (max-width: 768px)" type="text/css" rel="stylesheet" href="./背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园_files/bundle-SimpleBlue-mobile.css">
<link title="RSS" type="application/rss+xml" rel="alternate" href="http://www.cnblogs.com/xrwang/rss">
<link title="RSD" type="application/rsd+xml" rel="EditURI" href="http://www.cnblogs.com/xrwang/rsd.xml">
<link type="application/wlwmanifest+xml" rel="wlwmanifest" href="http://www.cnblogs.com/xrwang/wlwmanifest.xml">
<script src="./背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园_files/jquery.js" type="text/javascript"></script>  
<script type="text/javascript">var currentBlogApp = 'xrwang', cb_enable_mathjax=false;var isLogined=false;</script>
<script src="./背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园_files/blog-common.js" type="text/javascript"></script>
</head>
<body>
<a name="top"></a>

<div id="home">
<div id="header">
	<div id="blogTitle">
		
<!--done-->
<div class="title"><a id="Header1_HeaderTitle" class="headermaintitle" href="http://www.cnblogs.com/xrwang/">无涯（C、.net、图像处理、算法）</a></div>
<div class="subtitle"></div>



		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li id="nav_sitehome"><a id="blog_nav_sitehome" class="menu" href="http://www.cnblogs.com/">博客园</a></li>
<li id="nav_myhome"><a id="blog_nav_myhome" class="menu" href="http://www.cnblogs.com/xrwang/">首页</a></li>
<li id="nav_newpost"><a id="blog_nav_newpost" class="menu" rel="nofollow" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">新随笔</a></li>
<li id="nav_contact"><a id="blog_nav_contact" class="menu" rel="nofollow" href="https://msg.cnblogs.com/send/Wuya">联系</a></li>
<li id="nav_rss"><a id="blog_nav_rss" class="menu" href="http://www.cnblogs.com/xrwang/rss">订阅</a>
<!--<a id="blog_nav_rss_image" class="aHeaderXML" href="http://www.cnblogs.com/xrwang/rss"><img src="//www.cnblogs.com/images/xml.gif" alt="订阅" /></a>--></li>
<li id="nav_admin"><a id="blog_nav_admin" class="menu" rel="nofollow" href="https://i.cnblogs.com/">管理</a></li>
</ul>

		<div class="blogStats">
			
			<div id="blog_stats">
<!--done-->
随笔-40&nbsp;
文章-0&nbsp;
评论-845&nbsp;
</div>
			
		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->
<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		
<div id="post_detail">
<!--done-->
<div id="topics">
	<div class="post">
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2" href="./背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园_files/背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园.html">背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3)</a>
		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body"><p>作者：王先荣</p>
<p>&nbsp;&nbsp;&nbsp; 在上一篇文章里，我尝试翻译了《Nonparametric Background Generation》，本文主要介绍以下内容：如何实现该论文的算法，如果利用该算法来进行背景建模及前景检测，最后谈谈我的一些体会。为了使描述更加简便，以下将该论文的算法及实现称为NBGModel。<br><b>1 使用示例</b><br>&nbsp;&nbsp;&nbsp; NBGModel在使用上非常的简便，您可以仿照下面的代码来使用它：<br>
</p><div class="cnblogs_code"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #008000;">//</span><span style="color: #008000;">初始化NBGModel对象</span><span style="color: #008000;"><br></span><span style="color: #000000;">NBGModel nbgModel </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> NBGModel(</span><span style="color: #800080;">320</span><span style="color: #000000;">, </span><span style="color: #800080;">240</span><span style="color: #000000;">);<br></span><span style="color: #008000;">//</span><span style="color: #008000;">训练背景模型</span><span style="color: #008000;"><br></span><span style="color: #000000;">nbgModel.TrainBackgroundModel(historyImages);<br></span><span style="color: #008000;">//</span><span style="color: #008000;">前景检测</span><span style="color: #008000;"><br></span><span style="color: #000000;">nbgModel.Update(currentFrame);<br></span><span style="color: #008000;">//</span><span style="color: #008000;">利用结果</span><span style="color: #008000;"><br></span><span style="color: #000000;">pbResult.Image </span><span style="color: #000000;">=</span><span style="color: #000000;"> nbgModel.ForegroundMask.Bitmap;<br></span><span style="color: #008000;">//</span><span style="color: #008000;">释放对象</span><span style="color: #008000;"><br></span><span style="color: #000000;">nbgModel.Dispose();</span></div></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
<img src="./背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园_files/2010041211055743.png"><p></p>
<p>下面是更加完整的示例：</p>
<p>
</p><div class="cnblogs_code" onclick="cnblogs_code_show(&#39;27d427e2-cd3c-428e-b0a5-4f834ec8d4c2&#39;)"><img src="./背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园_files/ContractedBlock.gif" class="code_img_closed" id="code_img_closed_27d427e2-cd3c-428e-b0a5-4f834ec8d4c2" style="display: none;"><img src="./背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园_files/ExpandedBlockStart.gif" class="code_img_opened" id="code_img_opened_27d427e2-cd3c-428e-b0a5-4f834ec8d4c2" onclick="cnblogs_code_hide(&#39;27d427e2-cd3c-428e-b0a5-4f834ec8d4c2&#39;,event)" style=""><span class="cnblogs_code_collapse" style="display: none;">更加完整的示例</span>
<div id="cnblogs_code_open_27d427e2-cd3c-428e-b0a5-4f834ec8d4c2" class="cnblogs_code_hide" style="display: block;"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #0000ff;">using</span><span style="color: #000000;"> System;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Collections.Generic;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.ComponentModel;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Data;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Drawing;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Linq;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Text;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Windows.Forms;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Drawing.Imaging;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Diagnostics;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Runtime.InteropServices;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> Emgu.CV;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> Emgu.CV.Structure;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> Emgu.CV.CvEnum;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Threading;<br><br></span><span style="color: #0000ff;">namespace</span><span style="color: #000000;"> ImageProcessLearn<br>{<br>    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">partial</span><span style="color: #000000;"> </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> FormForegroundDetect2 : Form<br>    {<br>        </span><span style="color: #008000;">//</span><span style="color: #008000;">成员变量<br>        </span><span style="color: #008000;">//</span><span style="color: #008000;">public const string ImageFilePathName = @"D:\Users\xrwang\Desktop\背景建模与前景检测\PETS2009\Crowd_PETS09\S0\City_Center\Time_12-34\View_001\frame_{0:D4}.jpg";</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">const</span><span style="color: #000000;"> </span><span style="color: #0000ff;">string</span><span style="color: #000000;"> ImageFilePathName </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800000;">@"</span><span style="color: #800000;">E:\PETS2009\S0_City_Center\Time_12-34\View_002\frame_{0:D4}.jpg</span><span style="color: #800000;">"</span><span style="color: #000000;">; </span><span style="color: #008000;">//</span><span style="color: #008000;">图像文件的路径信息，其中的{xxx}部分需要被实际的索引数字替换</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">const</span><span style="color: #000000;"> </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> ImageWidth </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">768</span><span style="color: #000000;">;                  </span><span style="color: #008000;">//</span><span style="color: #008000;">图像的宽度</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">const</span><span style="color: #000000;"> </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> ImageHeight </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">576</span><span style="color: #000000;">;                 </span><span style="color: #008000;">//</span><span style="color: #008000;">图像的高度</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">const</span><span style="color: #000000;"> </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> MaxImageFileIndexNumber </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">794</span><span style="color: #000000;">;     </span><span style="color: #008000;">//</span><span style="color: #008000;">最大的图像索引数字</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> Action action </span><span style="color: #000000;">=</span><span style="color: #000000;"> Action.Stop;                </span><span style="color: #008000;">//</span><span style="color: #008000;">当前正在执行的动作</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> NBGModel nbgModel </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">;                   </span><span style="color: #008000;">//</span><span style="color: #008000;">非参数背景模型</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> Thread threadTrainingBackground </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">;     </span><span style="color: #008000;">//</span><span style="color: #008000;">用于训练背景的工作线程</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> Thread threadForegroundDetection </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">;    </span><span style="color: #008000;">//</span><span style="color: #008000;">用于前景检测的工作线程</span><span style="color: #008000;"><br></span><span style="color: #000000;"><br>        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> FormForegroundDetect2()<br>        {<br>            InitializeComponent();<br>        }<br><br>        </span><span style="color: #008000;">//</span><span style="color: #008000;">开始训练背景</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> btnStartTrainingBackground_Click(</span><span style="color: #0000ff;">object</span><span style="color: #000000;"> sender, EventArgs e)<br>        {<br>            threadTrainingBackground </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Thread(</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> ThreadStart(TrainingBackground));<br>            threadTrainingBackground.Start();<br>            action </span><span style="color: #000000;">=</span><span style="color: #000000;"> Action.StartTrainingBackground;<br>            SetButtonState();<br>        }<br><br>        </span><span style="color: #008000;">//</span><span style="color: #008000;">训练背景</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> TrainingBackground()<br>        {<br>            </span><span style="color: #008000;">//</span><span style="color: #008000;">构造非参数背景模型对象</span><span style="color: #008000;"><br></span><span style="color: #000000;">            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (nbgModel </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">)<br>                nbgModel.Dispose();<br>            NBGParameter param </span><span style="color: #000000;">=</span><span style="color: #000000;"> (NBGParameter)</span><span style="color: #0000ff;">this</span><span style="color: #000000;">.Invoke(</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> GetNBGParameterDelegate(GetNBGParameter));<br>            nbgModel </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> NBGModel(ImageWidth, ImageHeight, param);            <br>            </span><span style="color: #008000;">//</span><span style="color: #008000;">添加用于训练的图像</span><span style="color: #008000;"><br></span><span style="color: #000000;">            </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> idx </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; idx </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> param.n; idx</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>            {<br>                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (action </span><span style="color: #000000;">!=</span><span style="color: #000000;"> Action.StartTrainingBackground)<br>                    </span><span style="color: #0000ff;">return</span><span style="color: #000000;">;<br>                Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Bgr, Byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> image </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Bgr, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">(</span><span style="color: #0000ff;">string</span><span style="color: #000000;">.Format(ImageFilePathName, idx));<br>                nbgModel.AddHistoryImage(image);<br>                </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.Invoke(</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> ShowTrainingBackgroundImageDelegate(ShowTrainingBackgroundImage),<br>                    </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> </span><span style="color: #0000ff;">object</span><span style="color: #000000;">[] { image.Bitmap, idx });<br>                image.Dispose();<br>            }<br>            </span><span style="color: #008000;">//</span><span style="color: #008000;">训练背景</span><span style="color: #008000;"><br></span><span style="color: #000000;">            Stopwatch sw </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Stopwatch();<br>            sw.Start();<br>            nbgModel.TrainBackgroundModel();<br>            sw.Stop();<br>            </span><span style="color: #008000;">//</span><span style="color: #008000;">显示结果</span><span style="color: #008000;"><br></span><span style="color: #000000;">            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.Invoke(</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> ShowTrainingBackgroundResultDelegate(ShowTrainingBackgroundResult),<br>                </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> </span><span style="color: #0000ff;">object</span><span style="color: #000000;">[]{ nbgModel.Mrbm.Bitmap,</span><span style="color: #0000ff;">string</span><span style="color: #000000;">.Format(</span><span style="color: #800000;">"</span><span style="color: #800000;">NBGModel训练背景用时{0:F04}毫秒，参数（样本数目：{1}，典型点数目：{2}）。</span><span style="color: #800000;">"</span><span style="color: #000000;">,sw.ElapsedMilliseconds,param.n,param.m)});<br>        }<br><br>        </span><span style="color: #008000;">//</span><span style="color: #008000;">用于在训练背景工作线程中获取设置参数的委托及方法</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">delegate</span><span style="color: #000000;"> NBGParameter GetNBGParameterDelegate();<br>        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> NBGParameter GetNBGParameter()<br>        {<br>            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> NBGParameter((</span><span style="color: #0000ff;">int</span><span style="color: #000000;">)nudNBGModelN.Value, (</span><span style="color: #0000ff;">int</span><span style="color: #000000;">)nudNBGModelM.Value, (</span><span style="color: #0000ff;">double</span><span style="color: #000000;">)nudNBGModelTheta.Value, (</span><span style="color: #0000ff;">double</span><span style="color: #000000;">)nudNBGModelT.Value, </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> MCvTermCriteria((</span><span style="color: #0000ff;">int</span><span style="color: #000000;">)nudNBGModelMaxIter.Value, (</span><span style="color: #0000ff;">double</span><span style="color: #000000;">)nudNBGModelEps.Value));<br>        }<br><br>        </span><span style="color: #008000;">//</span><span style="color: #008000;">用于在训练背景工作线程中显示结果的委托及方法</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">delegate</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> ShowTrainingBackgroundResultDelegate(Bitmap mrbm, </span><span style="color: #0000ff;">string</span><span style="color: #000000;"> result);<br>        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> ShowTrainingBackgroundResult(Bitmap mrbm, </span><span style="color: #0000ff;">string</span><span style="color: #000000;"> result)<br>        {<br>            pbResult.Image </span><span style="color: #000000;">=</span><span style="color: #000000;"> mrbm;<br>            txtResult.Text </span><span style="color: #000000;">+=</span><span style="color: #000000;"> result </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800000;">"</span><span style="color: #800000;">\r\n</span><span style="color: #800000;">"</span><span style="color: #000000;">;<br>            action </span><span style="color: #000000;">=</span><span style="color: #000000;"> Action.Stop;<br>            SetButtonState();<br>        }<br><br>        </span><span style="color: #008000;">//</span><span style="color: #008000;">用于在训练背景工作线程中显示训练图像的委托及方法</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">delegate</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> ShowTrainingBackgroundImageDelegate(Bitmap bitmap, </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> idx);<br>        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> ShowTrainingBackgroundImage(Bitmap bitmap, </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> idx)<br>        {<br>            pbSource.Image </span><span style="color: #000000;">=</span><span style="color: #000000;"> bitmap;<br>            lblImageIndex.Text </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">string</span><span style="color: #000000;">.Format(</span><span style="color: #800000;">"</span><span style="color: #800000;">{0:D4}</span><span style="color: #800000;">"</span><span style="color: #000000;">, idx);<br>        }<br><br>        </span><span style="color: #008000;">//</span><span style="color: #008000;">开始前景检测</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> btnStartForegroundDetection_Click(</span><span style="color: #0000ff;">object</span><span style="color: #000000;"> sender, EventArgs e)<br>        {<br>            threadForegroundDetection </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Thread(</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> ThreadStart(ForegroundDetection));<br>            threadForegroundDetection.Start();<br>            action </span><span style="color: #000000;">=</span><span style="color: #000000;"> Action.StartForegroundDetection;<br>            SetButtonState();<br>        }<br><br>        </span><span style="color: #008000;">//</span><span style="color: #008000;">检测前景</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> ForegroundDetection()<br>        {<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (nbgModel </span><span style="color: #000000;">==</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">)<br>                </span><span style="color: #0000ff;">return</span><span style="color: #000000;">;<br>            Stopwatch sw </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Stopwatch();<br>            </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> idx;<br>            </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (idx </span><span style="color: #000000;">=</span><span style="color: #000000;"> nbgModel.Param.n; idx </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> MaxImageFileIndexNumber; idx</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>            {<br>                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (action </span><span style="color: #000000;">!=</span><span style="color: #000000;"> Action.StartForegroundDetection)<br>                    </span><span style="color: #0000ff;">break</span><span style="color: #000000;">;<br>                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> ((idx </span><span style="color: #000000;">-</span><span style="color: #000000;"> nbgModel.Param.n) </span><span style="color: #000000;">%</span><span style="color: #000000;"> </span><span style="color: #800080;">50</span><span style="color: #000000;"> </span><span style="color: #000000;">==</span><span style="color: #000000;"> </span><span style="color: #800080;">49</span><span style="color: #000000;">)<br>                    nbgModel.ClearStale(</span><span style="color: #800080;">40</span><span style="color: #000000;">);<br>                Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Bgr, Byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> image </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Bgr, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">(</span><span style="color: #0000ff;">string</span><span style="color: #000000;">.Format(ImageFilePathName, idx));<br>                sw.Start();<br>                nbgModel.Update(image);<br>                sw.Stop();<br>                Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Bgr, Byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> imageForground </span><span style="color: #000000;">=</span><span style="color: #000000;"> image.Copy(nbgModel.ForegroundMask);<br>                </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.Invoke(</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> ShowForegroundDetectionImageDelegate(ShowForegroundDetectionImage),<br>                    </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> </span><span style="color: #0000ff;">object</span><span style="color: #000000;">[] { image.Bitmap, imageForground.Bitmap, idx });<br>                image.Dispose();<br>                imageForground.Dispose();<br>            }<br>            </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> frames </span><span style="color: #000000;">=</span><span style="color: #000000;"> idx </span><span style="color: #000000;">-</span><span style="color: #000000;"> nbgModel.Param.n;<br>            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.Invoke(</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> ShowForegroundDetectionResultDelegate(ShowForegroundDetectionResult),<br>                </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> </span><span style="color: #0000ff;">object</span><span style="color: #000000;">[] { </span><span style="color: #0000ff;">string</span><span style="color: #000000;">.Format(</span><span style="color: #800000;">"</span><span style="color: #800000;">NBGModel前景检测，共{0}帧，平均耗时{1:F04}毫秒，参数（样本数目：{2}，典型点数目：{3}，权重系数：{4}，最小差值：{5}，最大迭代次数：{6}，终止精度：{7}）</span><span style="color: #800000;">"</span><span style="color: #000000;">,<br>                frames,1d</span><span style="color: #000000;">*</span><span style="color: #000000;">sw.ElapsedMilliseconds</span><span style="color: #000000;">/</span><span style="color: #000000;">frames,nbgModel.Param.n,nbgModel.Param.m,nbgModel.Param.theta,nbgModel.Param.t,nbgModel.Param.criteria.max_iter,nbgModel.Param.criteria.epsilon)});<br>        }<br><br>        </span><span style="color: #008000;">//</span><span style="color: #008000;">用于在前景检测工作线程中显示图像的委托及方法</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">delegate</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> ShowForegroundDetectionImageDelegate(Bitmap image, Bitmap foreground, </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> idx);<br>        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> ShowForegroundDetectionImage(Bitmap image, Bitmap foreground, </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> idx)<br>        {<br>            pbSource.Image </span><span style="color: #000000;">=</span><span style="color: #000000;"> image;<br>            pbResult.Image </span><span style="color: #000000;">=</span><span style="color: #000000;"> foreground;<br>            lblImageIndex.Text </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">string</span><span style="color: #000000;">.Format(</span><span style="color: #800000;">"</span><span style="color: #800000;">{0:D4}</span><span style="color: #800000;">"</span><span style="color: #000000;">, idx);<br>        }<br><br>        </span><span style="color: #008000;">//</span><span style="color: #008000;">用于在前景检测工作线程中显示结果的委托及方法</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">delegate</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> ShowForegroundDetectionResultDelegate(</span><span style="color: #0000ff;">string</span><span style="color: #000000;"> result);<br>        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> ShowForegroundDetectionResult(</span><span style="color: #0000ff;">string</span><span style="color: #000000;"> result)<br>        {<br>            txtResult.Text </span><span style="color: #000000;">+=</span><span style="color: #000000;"> result;<br>        }<br><br>        </span><span style="color: #008000;">//</span><span style="color: #008000;">停止</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> btnStop_Click(</span><span style="color: #0000ff;">object</span><span style="color: #000000;"> sender, EventArgs e)<br>        {<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (action </span><span style="color: #000000;">==</span><span style="color: #000000;"> Action.StartTrainingBackground)<br>            {<br>                action </span><span style="color: #000000;">=</span><span style="color: #000000;"> Action.Stop;<br>                Thread.Sleep(</span><span style="color: #800080;">1</span><span style="color: #000000;">);<br>                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (threadTrainingBackground.ThreadState </span><span style="color: #000000;">==</span><span style="color: #000000;"> System.Threading.ThreadState.Running)<br>                    threadTrainingBackground.Abort();<br>                nbgModel.Dispose();<br>                nbgModel </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">;<br>            }<br>            action </span><span style="color: #000000;">=</span><span style="color: #000000;"> Action.Stop;<br>            SetButtonState();<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 设置按钮的状态<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> SetButtonState()<br>        {<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (action </span><span style="color: #000000;">==</span><span style="color: #000000;"> Action.Stop)<br>            {<br>                btnStartTrainingBackground.Enabled </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">true</span><span style="color: #000000;">;<br>                btnStartForegroundDetection.Enabled </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">true</span><span style="color: #000000;">;<br>                btnStop.Enabled </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">false</span><span style="color: #000000;">;<br>            }<br>            </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (action </span><span style="color: #000000;">==</span><span style="color: #000000;"> Action.StartForegroundDetection </span><span style="color: #000000;">||</span><span style="color: #000000;"> action</span><span style="color: #000000;">==</span><span style="color: #000000;">Action.StartTrainingBackground)<br>            {<br>                btnStartTrainingBackground.Enabled </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">false</span><span style="color: #000000;">;<br>                btnStartForegroundDetection.Enabled </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">false</span><span style="color: #000000;">;<br>                btnStop.Enabled </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">true</span><span style="color: #000000;">;<br>            }<br>        }<br><br>        </span><span style="color: #008000;">//</span><span style="color: #008000;">加载窗体时</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> FormForegroundDetect2_Load(</span><span style="color: #0000ff;">object</span><span style="color: #000000;"> sender, EventArgs e)<br>        {<br>            toolTip.SetToolTip(nudNBGModelN, </span><span style="color: #800000;">"</span><span style="color: #800000;">样本数目：需要被保存的历史图像数目</span><span style="color: #800000;">"</span><span style="color: #000000;">);<br>            toolTip.SetToolTip(nudNBGModelM, </span><span style="color: #800000;">"</span><span style="color: #800000;">典型点数目：历史图像需要被分为多少组</span><span style="color: #800000;">"</span><span style="color: #000000;">);<br>            toolTip.SetToolTip(nudNBGModelTheta, </span><span style="color: #800000;">"</span><span style="color: #800000;">权重系数：权重大于该值的聚集中心是候选背景</span><span style="color: #800000;">"</span><span style="color: #000000;">);<br>            toolTip.SetToolTip(nudNBGModelT, </span><span style="color: #800000;">"</span><span style="color: #800000;">最小差值：观测值与聚集中心的最小差值如果大于该值，为前景；否则为背景</span><span style="color: #800000;">"</span><span style="color: #000000;">);<br>            toolTip.SetToolTip(nudNBGModelMaxIter, </span><span style="color: #800000;">"</span><span style="color: #800000;">最大迭代次数：MeanShift计算过程中的最大迭代次数</span><span style="color: #800000;">"</span><span style="color: #000000;">);<br>            toolTip.SetToolTip(nudNBGModelEps, </span><span style="color: #800000;">"</span><span style="color: #800000;">终止精度：MeanShift计算过程中，如果矩形窗的位移小于等于该值，则停止计算</span><span style="color: #800000;">"</span><span style="color: #000000;">);<br><br>            pbSource.Image </span><span style="color: #000000;">=</span><span style="color: #000000;"> Image.FromFile(</span><span style="color: #0000ff;">string</span><span style="color: #000000;">.Format(ImageFilePathName, </span><span style="color: #800080;">0</span><span style="color: #000000;">));<br>            lblImageIndex.Text </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">string</span><span style="color: #000000;">.Format(</span><span style="color: #800000;">"</span><span style="color: #800000;">{0:D4}</span><span style="color: #800000;">"</span><span style="color: #000000;">, </span><span style="color: #800080;">0</span><span style="color: #000000;">);<br>        }<br><br>        </span><span style="color: #008000;">//</span><span style="color: #008000;">当窗体关闭后，释放资源</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> FormForegroundDetect2_FormClosed(</span><span style="color: #0000ff;">object</span><span style="color: #000000;"> sender, FormClosedEventArgs e)<br>        {<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (threadTrainingBackground </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;"> </span><span style="color: #000000;">&amp;&amp;</span><span style="color: #000000;"> threadTrainingBackground.ThreadState </span><span style="color: #000000;">==</span><span style="color: #000000;"> System.Threading.ThreadState.Running)<br>                threadTrainingBackground.Abort();<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (threadForegroundDetection </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;"> </span><span style="color: #000000;">&amp;&amp;</span><span style="color: #000000;"> threadForegroundDetection.ThreadState </span><span style="color: #000000;">==</span><span style="color: #000000;"> System.Threading.ThreadState.Running)<br>                threadForegroundDetection.Abort();<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (nbgModel </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">)<br>                nbgModel.Dispose();<br>        }<br>    }<br><br>    </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>    </span><span style="color: #808080;">///</span><span style="color: #008000;"> 当前正在执行的动作<br>    </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">enum</span><span style="color: #000000;"> Action<br>    {<br>        StartTrainingBackground,    </span><span style="color: #008000;">//</span><span style="color: #008000;">开始训练背景</span><span style="color: #008000;"><br></span><span style="color: #000000;">        StartForegroundDetection,   </span><span style="color: #008000;">//</span><span style="color: #008000;">开始前景检测</span><span style="color: #008000;"><br></span><span style="color: #000000;">        Stop                        </span><span style="color: #008000;">//</span><span style="color: #008000;">停止</span><span style="color: #008000;"><br></span><span style="color: #000000;">    }<br>}<br></span></div></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
</div>
<p>&nbsp;</p>
<p></p>
<p><b>2 实现NBGModel</b><br>&nbsp;&nbsp;&nbsp; <b>2.1 我在实现NBGModel的时候基本上跟论文中的方式一样，不过有以下两点区别：</b><br>（1）论文中的MeanShift计算使用了Epanechnikov核函数，我使用的是矩形窗形式的MeanShift计算。主要是因为我自己不会实现MeanShift，只能利用OpenCV中提供的cvMeanShift函数。这样做也有一个好处——不再需要计算与保存典型点。<br>（2）论文中的方法在检测的过程中聚集中心会不断的增加，我模仿CodeBook的实现为其增加了一个清除消极聚集中心的ClearStable方法。这样可以在必要的时候将长期不活跃的聚集中心清除掉。</p>
<p>&nbsp;&nbsp;&nbsp; <b>2.2 NBGModel中用到的数据成员如下所示：</b><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private int width;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //图像的宽度<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private int height;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //图像的高度<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private NBGParameter param;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //非参数背景模型的参数</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private List&lt;Image&lt;Ycc, Byte&gt;&gt; historyImages = null;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //历史图像：列表个数为param.n，在更新时如果个数大于等于param.n，删除最早的历史图像，加入最新的历史图像<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //由于这里采用矩形窗口方式的MeanShift计算，因此不再需要分组图像的典型点。这跟论文不一样。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //private List&lt;Image&lt;Ycc,Byte&gt;&gt; convergenceImages = null;&nbsp;&nbsp; //收敛图像：列表个数为param.m，仅在背景训练时使用，训练结束即被清空，因此这里不再声明<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private Image&lt;Gray, Byte&gt; sampleImage = null;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //样本图像：保存历史图像中每个像素在Y通道的值，用于MeanShift计算<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private List&lt;ClusterCenter&lt;Ycc&gt;&gt;[,] clusterCenters = null;&nbsp; //聚集中心数据：将收敛点分类之后得到的聚集中心，数组大小为：height x width，列表元素个数不定q（q&lt;=m）。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private Image&lt;Ycc, Byte&gt; mrbm = null;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //最可靠背景模型</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private Image&lt;Gray, Byte&gt; backgroundMask = null;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //背景掩码图像</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; private double frameCount = 0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //总帧数（不包括训练阶段的帧数n）</p>
<p>其中，NBGParameter结构包含以下成员：<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int n;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //样本数目：需要被保留的历史图像数目<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public int m;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //典型点数目：历史图像需要被分为多少组<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public double theta;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //权重系数：权重大于该值的聚集中心为候选背景<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public double t;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //最小差值：观测值与候选背景的最小差值大于该值时，为前景；否则为背景<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public MCvTermCriteria criteria;&nbsp;&nbsp;&nbsp; //Mean Shift计算的终止条件：包括最大迭代次数和终止计算的精度</p>
<p>聚集中心ClusterCenter使用类而不是结构，是为了方便更新，它包含以下成员：<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public TColor ci;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //聚集中心的像素值<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public double wi;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //聚集中心的权重<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public double li;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; //聚集中心包含的收敛点数目<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; public double updateFrameNo;&nbsp;&nbsp; //更新该聚集中心时的帧数：用于清除消极的聚集中心</p>
<p>&nbsp;&nbsp;&nbsp; <b>2.3 NBGModel中的关键流程</b><br>1.背景建模<br>（1）将训练用的样本图像添加到历史图像historyImages中；<br>（2）将历史图像分为m组，以每组所在位置的矩形窗为起点进行MeanShift计算，结果窗的中点为收敛中心，收敛中心的像素值为收敛值，将收敛值添加到收敛图像convergenceImages中；<br>（3）计算收敛图像的聚集中心：（a）得到收敛中心的最小值Cmin；（b）将[0,Cmin+t]区间中的收敛中心划分为一类；（c）计算已分类收敛中心的平均值，作为聚集中心的值；（d）删除已分类的收敛中心；（e）重复a～d，直到收敛中心全部归类；<br>（4）得到最可靠背景模型MRBM：在聚集中心中选取wi最大的值作为某个像素的最可靠背景。</p>
<p>2.前景检测<br>（1）用wi≥theta作为条件选择可能的背景组Cb；<br>（2）对每个观测值x0，计算x0与Cb的最小差值d；<br>（3）如果d&gt;t，则该点为前景；否则为背景。</p>
<p>3.背景维持<br>（1）如果某点为背景，更新最近聚集中心的wi为(li+1)/m；<br>（2）如果某点为前景：（a）以该点所在的矩形窗为起点进行MeanShift计算，可得到新的收敛中心Cnew（wi=1/m)；（b）将Cnew加入到聚集中心clusterCenters；<br>（3）在必要的时候，清理消极的聚集中心。</p>
<p>&nbsp;&nbsp;&nbsp; <b>2.4 NBGModel的实现代码</b><br>值得注意的是：在实现代码中，有好几个以2结尾的私有方法，它们主要用于演示算法流程，实际上并未使用。为了优化性能而增加了不少指针操作之后的代码可读性变得很差。</p>
<p>
</p><div class="cnblogs_code" onclick="cnblogs_code_show(&#39;c182632e-948e-4ed6-80c1-ae108a9c27ad&#39;)"><img src="./背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园_files/ContractedBlock.gif" class="code_img_closed" id="code_img_closed_c182632e-948e-4ed6-80c1-ae108a9c27ad" style="display: none;"><img src="./背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园_files/ExpandedBlockStart.gif" class="code_img_opened" id="code_img_opened_c182632e-948e-4ed6-80c1-ae108a9c27ad" onclick="cnblogs_code_hide(&#39;c182632e-948e-4ed6-80c1-ae108a9c27ad&#39;,event)" style=""><span class="cnblogs_code_collapse" style="display: none;">NBGModel实现代码</span>
<div id="cnblogs_code_open_c182632e-948e-4ed6-80c1-ae108a9c27ad" class="cnblogs_code_hide" style="display: block;"><div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园_files/copycode.gif" alt="复制代码"></a></span></div>
<pre><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #0000ff;">using</span><span style="color: #000000;"> System;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Collections.Generic;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Linq;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Text;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Drawing;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Drawing.Imaging;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Diagnostics;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> System.Runtime.InteropServices;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> Emgu.CV;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> Emgu.CV.Structure;<br></span><span style="color: #0000ff;">using</span><span style="color: #000000;"> Emgu.CV.CvEnum;<br><br></span><span style="color: #0000ff;">namespace</span><span style="color: #000000;"> ImageProcessLearn<br>{<br>    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> NBGModel : IDisposable<br>    {<br>        </span><span style="color: #008000;">//</span><span style="color: #008000;">成员变量</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> width;                                          </span><span style="color: #008000;">//</span><span style="color: #008000;">图像的宽度</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> height;                                         </span><span style="color: #008000;">//</span><span style="color: #008000;">图像的高度</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> NBGParameter param;                                 </span><span style="color: #008000;">//</span><span style="color: #008000;">非参数背景模型的参数</span><span style="color: #008000;"><br></span><span style="color: #000000;"><br>        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> List</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc, Byte</span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;"> historyImages </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">;        </span><span style="color: #008000;">//</span><span style="color: #008000;">历史图像：列表个数为param.n，在更新时如果个数大于param.n，删除最早的历史图像，加入最新的历史图像<br>        </span><span style="color: #008000;">//</span><span style="color: #008000;">由于这里采用矩形窗口方式的MeanShift计算，因此不再需要分组图像的典型点。这跟论文不一样。<br>        </span><span style="color: #008000;">//</span><span style="color: #008000;">private List&lt;Image&lt;Ycc,Byte&gt;&gt; convergenceImages = null;   </span><span style="color: #008000;">//</span><span style="color: #008000;">收敛图像：列表个数为param.m，仅在背景训练时使用，训练结束即被清空，因此这里不再声明</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Gray, Byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> sampleImage </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">;               </span><span style="color: #008000;">//</span><span style="color: #008000;">样本图像：保存历史图像中每个像素在Y通道的值，用于MeanShift计算</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> List</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">ClusterCenter</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc</span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;">[,] clusterCenters </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">;  </span><span style="color: #008000;">//</span><span style="color: #008000;">聚集中心数据：将收敛点分类之后得到的聚集中心，数组大小为：height x width，列表元素个数不定q（q&lt;=m）。</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc, Byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> mrbm </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">;                       </span><span style="color: #008000;">//</span><span style="color: #008000;">最可靠背景模型</span><span style="color: #008000;"><br></span><span style="color: #000000;"><br>        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Gray, Byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> backgroundMask </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">;            </span><span style="color: #008000;">//</span><span style="color: #008000;">背景掩码图像</span><span style="color: #008000;"><br></span><span style="color: #000000;"><br>        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> frameCount </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">;                              </span><span style="color: #008000;">//</span><span style="color: #008000;">总帧数（不包括训练阶段的帧数n）<br><br>        </span><span style="color: #008000;">//</span><span style="color: #008000;">属性</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 图像的宽度<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> Width<br>        {<br>            </span><span style="color: #0000ff;">get</span><span style="color: #000000;"><br>            {<br>                </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> width;<br>            }<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 图像的高度<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> Height<br>        {<br>            </span><span style="color: #0000ff;">get</span><span style="color: #000000;"><br>            {<br>                </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> height;<br>            }<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 非参数背景模型的参数<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> NBGParameter Param<br>        {<br>            </span><span style="color: #0000ff;">get</span><span style="color: #000000;"><br>            {<br>                </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> param;<br>            }<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 最可靠背景模型<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc, Byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> Mrbm<br>        {<br>            </span><span style="color: #0000ff;">get</span><span style="color: #000000;"><br>            {<br>                </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> mrbm;<br>            }<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 背景掩码<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Gray, Byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> BackgroundMask<br>        {<br>            </span><span style="color: #0000ff;">get</span><span style="color: #000000;"><br>            {<br>                </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> backgroundMask;<br>            }<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 前景掩码<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Gray, Byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> ForegroundMask<br>        {<br>            </span><span style="color: #0000ff;">get</span><span style="color: #000000;"><br>            {<br>                </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> backgroundMask.Not();<br>            }<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 总帧数<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> FrameCount<br>        {<br>            </span><span style="color: #0000ff;">get</span><span style="color: #000000;"><br>            {<br>                </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> frameCount;<br>            }<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 构造函数<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="width"&gt;</span><span style="color: #008000;">图像宽度</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="height"&gt;</span><span style="color: #008000;">图像高度</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> NBGModel(</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> width, </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> height)<br>            : </span><span style="color: #0000ff;">this</span><span style="color: #000000;">(width, height, NBGParameter.GetDefaultNBGParameter())<br>        {<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 构造函数<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="width"&gt;</span><span style="color: #008000;">图像宽度</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="height"&gt;</span><span style="color: #008000;">图像高度</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #808080;">&lt;param name="param"&gt;</span><span style="color: #008000;">非参数背景模型的参数</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> NBGModel(</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> width, </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> height, NBGParameter param)<br>        {<br>            CheckParameters(width, height, param);<br>            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.width </span><span style="color: #000000;">=</span><span style="color: #000000;"> width;<br>            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.height </span><span style="color: #000000;">=</span><span style="color: #000000;"> height;<br>            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.param </span><span style="color: #000000;">=</span><span style="color: #000000;"> param;<br><br>            historyImages </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> List</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;">(param.n);<br>            sampleImage </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Gray, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">(param.n, </span><span style="color: #800080;">1</span><span style="color: #000000;">);<br>            clusterCenters </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> List</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">ClusterCenter</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc</span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;">[height, width];<br>            </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> row </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; row </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> height; row</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>            {<br>                </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> col </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; col </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> width; col</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                    clusterCenters[row, col] </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> List</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">ClusterCenter</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc</span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;">(param.m);   </span><span style="color: #008000;">//</span><span style="color: #008000;">聚集中心列表不定长，因此将其初始化为m个元素的容量</span><span style="color: #008000;"><br></span><span style="color: #000000;">            }<br>            mrbm </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">(width, height);<br>            backgroundMask </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Gray, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">(width, height);<br>            frameCount </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">;<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 检查参数是否正确，如果不正确，抛出异常<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="width"&gt;</span><span style="color: #008000;">图像宽度</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="height"&gt;</span><span style="color: #008000;">图像高度</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="param"&gt;</span><span style="color: #008000;">非参数背景模型的参数</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> CheckParameters(</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> width, </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> height, NBGParameter param)<br>        {<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (width </span><span style="color: #000000;">&lt;=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">)<br>                </span><span style="color: #0000ff;">throw</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> ArgumentOutOfRangeException(</span><span style="color: #800000;">"</span><span style="color: #800000;">width</span><span style="color: #800000;">"</span><span style="color: #000000;">, width, </span><span style="color: #800000;">"</span><span style="color: #800000;">图像宽度必须大于零。</span><span style="color: #800000;">"</span><span style="color: #000000;">);<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (height </span><span style="color: #000000;">&lt;=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">)<br>                </span><span style="color: #0000ff;">throw</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> ArgumentOutOfRangeException(</span><span style="color: #800000;">"</span><span style="color: #800000;">height</span><span style="color: #800000;">"</span><span style="color: #000000;">, height, </span><span style="color: #800000;">"</span><span style="color: #800000;">图像高度必须大于零。</span><span style="color: #800000;">"</span><span style="color: #000000;">);<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (param.n </span><span style="color: #000000;">&lt;=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">)<br>                </span><span style="color: #0000ff;">throw</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> ArgumentOutOfRangeException(</span><span style="color: #800000;">"</span><span style="color: #800000;">n</span><span style="color: #800000;">"</span><span style="color: #000000;">, param.n, </span><span style="color: #800000;">"</span><span style="color: #800000;">样本数目必须大于零。</span><span style="color: #800000;">"</span><span style="color: #000000;">);<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (param.m </span><span style="color: #000000;">&lt;=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">)<br>                </span><span style="color: #0000ff;">throw</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> ArgumentOutOfRangeException(</span><span style="color: #800000;">"</span><span style="color: #800000;">m</span><span style="color: #800000;">"</span><span style="color: #000000;">, param.m, </span><span style="color: #800000;">"</span><span style="color: #800000;">典型点数目必须大于零。</span><span style="color: #800000;">"</span><span style="color: #000000;">);<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (param.n </span><span style="color: #000000;">%</span><span style="color: #000000;"> param.m </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">)<br>                </span><span style="color: #0000ff;">throw</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> ArgumentException(</span><span style="color: #800000;">"</span><span style="color: #800000;">样本数目必须是典型点数目的整数倍。</span><span style="color: #800000;">"</span><span style="color: #000000;">, </span><span style="color: #800000;">"</span><span style="color: #800000;">n,m</span><span style="color: #800000;">"</span><span style="color: #000000;">);<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (param.theta </span><span style="color: #000000;">&lt;=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;"> </span><span style="color: #000000;">||</span><span style="color: #000000;"> param.theta </span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;">)<br>                </span><span style="color: #0000ff;">throw</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> ArgumentOutOfRangeException(</span><span style="color: #800000;">"</span><span style="color: #800000;">theta</span><span style="color: #800000;">"</span><span style="color: #000000;">, param.theta, </span><span style="color: #800000;">"</span><span style="color: #800000;">权重系数必须大于零，并且小于1。</span><span style="color: #800000;">"</span><span style="color: #000000;">);<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (param.t </span><span style="color: #000000;">&lt;=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">)<br>                </span><span style="color: #0000ff;">throw</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> ArgumentOutOfRangeException(</span><span style="color: #800000;">"</span><span style="color: #800000;">t</span><span style="color: #800000;">"</span><span style="color: #000000;">, param.t, </span><span style="color: #800000;">"</span><span style="color: #800000;">最小差值必须大于零。</span><span style="color: #800000;">"</span><span style="color: #000000;">);<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 释放资源<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> Dispose()<br>        {<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (historyImages </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;"> </span><span style="color: #000000;">&amp;&amp;</span><span style="color: #000000;"> historyImages.Count </span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">)<br>            {<br>                </span><span style="color: #0000ff;">foreach</span><span style="color: #000000;"> (Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> historyImage </span><span style="color: #0000ff;">in</span><span style="color: #000000;"> historyImages)<br>                {<br>                    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (historyImage </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">)<br>                        historyImage.Dispose();<br>                }<br>            }<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (sampleImage </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">)<br>                sampleImage.Dispose();<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (clusterCenters </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;"> </span><span style="color: #000000;">&amp;&amp;</span><span style="color: #000000;"> clusterCenters.Length </span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">)<br>            {<br>                </span><span style="color: #0000ff;">foreach</span><span style="color: #000000;"> (List</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">ClusterCenter</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc</span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;"> clusterCentersElement </span><span style="color: #0000ff;">in</span><span style="color: #000000;"> clusterCenters)<br>                    clusterCentersElement.Clear();<br>            }<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (mrbm </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">)<br>                mrbm.Dispose();<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (backgroundMask </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">)<br>                backgroundMask.Dispose();<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 增加历史图像<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="historyImage"&gt;</span><span style="color: #008000;">历史图像</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;returns&gt;</span><span style="color: #008000;">是否增加成功</span><span style="color: #808080;">&lt;/returns&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> AddHistoryImage(Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> historyImage)<br>        {<br>            </span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> success </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">false</span><span style="color: #000000;">;<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (historyImage </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;"> </span><span style="color: #000000;">&amp;&amp;</span><span style="color: #000000;"> historyImage.Width </span><span style="color: #000000;">==</span><span style="color: #000000;"> width </span><span style="color: #000000;">&amp;&amp;</span><span style="color: #000000;"> historyImage.Height </span><span style="color: #000000;">==</span><span style="color: #000000;"> height)<br>            {<br>                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (historyImages.Count </span><span style="color: #000000;">&gt;=</span><span style="color: #000000;"> param.n)<br>                {<br>                    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (historyImages[</span><span style="color: #800080;">0</span><span style="color: #000000;">] </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;">)<br>                        historyImages[</span><span style="color: #800080;">0</span><span style="color: #000000;">].Dispose();<br>                    historyImages.RemoveAt(</span><span style="color: #800080;">0</span><span style="color: #000000;">);<br>                }<br>                historyImages.Add(historyImage.Copy());<br>                success </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">true</span><span style="color: #000000;">;<br>            }<br>            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> success;<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 增加历史图像<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="historyImages"&gt;</span><span style="color: #008000;">历史图像数组</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;returns&gt;</span><span style="color: #008000;">返回成功增加的历史图像数目</span><span style="color: #808080;">&lt;/returns&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> AddHistoryImage(Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc,</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">[] historyImages)<br>        {<br>            </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> added </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">;<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (historyImages </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;"> </span><span style="color: #000000;">&amp;&amp;</span><span style="color: #000000;"> historyImages.Length </span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">)<br>            {<br>                </span><span style="color: #0000ff;">foreach</span><span style="color: #000000;"> (Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc,</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> historyImage </span><span style="color: #0000ff;">in</span><span style="color: #000000;"> historyImages)<br>                {<br>                    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (AddHistoryImage(historyImage))<br>                        added</span><span style="color: #000000;">++</span><span style="color: #000000;">;<br>                }<br>            }<br>            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> added;<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 增加历史图像<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="historyImages"&gt;</span><span style="color: #008000;">历史图像列表</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;returns&gt;</span><span style="color: #008000;">返回成功增加的历史图像数目</span><span style="color: #808080;">&lt;/returns&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> AddHistoryImage(List</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc,</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;"> historyImages)<br>        {<br>            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> AddHistoryImage(historyImages.ToArray());<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 增加历史图像<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="historyImage"&gt;</span><span style="color: #008000;">历史图像</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;returns&gt;</span><span style="color: #008000;">是否增加成功</span><span style="color: #808080;">&lt;/returns&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> AddHistoryImage(Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Bgr, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> historyImage)<br>        {<br>            Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> image </span><span style="color: #000000;">=</span><span style="color: #000000;"> historyImage.Convert</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">();<br>            </span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> success </span><span style="color: #000000;">=</span><span style="color: #000000;"> AddHistoryImage(image);<br>            image.Dispose();<br>            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> success;<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 增加历史图像<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="historyImages"&gt;</span><span style="color: #008000;">历史图像数组</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;returns&gt;</span><span style="color: #008000;">返回成功增加的历史图像数目</span><span style="color: #808080;">&lt;/returns&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> AddHistoryImage(Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Bgr, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">[] historyImages)<br>        {<br>            </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> added </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">;<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (historyImages </span><span style="color: #000000;">!=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">null</span><span style="color: #000000;"> </span><span style="color: #000000;">&amp;&amp;</span><span style="color: #000000;"> historyImages.Length </span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">)<br>            {<br>                </span><span style="color: #0000ff;">foreach</span><span style="color: #000000;"> (Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Bgr, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> historyImage </span><span style="color: #0000ff;">in</span><span style="color: #000000;"> historyImages)<br>                {<br>                    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (AddHistoryImage(historyImage))<br>                        added</span><span style="color: #000000;">++</span><span style="color: #000000;">;<br>                }<br>            }<br>            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> added;<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 增加历史图像<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="historyImages"&gt;</span><span style="color: #008000;">历史图像列表</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;returns&gt;</span><span style="color: #008000;">返回成功增加的历史图像数目</span><span style="color: #808080;">&lt;/returns&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> AddHistoryImage(List</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Bgr, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;"> historyImages)<br>        {<br>            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> AddHistoryImage(historyImages.ToArray());<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 训练背景模型<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;returns&gt;</span><span style="color: #008000;">返回训练是否成功</span><span style="color: #808080;">&lt;/returns&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">unsafe</span><span style="color: #000000;"> </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> TrainBackgroundModel()<br>        {<br>            </span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> success </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">false</span><span style="color: #000000;">;<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (historyImages.Count </span><span style="color: #000000;">&gt;=</span><span style="color: #000000;"> param.n)<br>            {<br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">0.初始化收敛图像，个数为param.m</span><span style="color: #008000;"><br></span><span style="color: #000000;">                List</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;"> convergenceImages </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> List</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;">(param.m);<br>                </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> param.m; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                    convergenceImages.Add(</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">(width, height));<br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">1.将历史图像分为m组，以每组的位置为矩形窗的起点，对通道Y在历史图像中进行MeanShift计算，结果窗的中点为收敛中心，该中心的值为收敛值，将收敛值加入到convergenceImageData中。</span><span style="color: #008000;"><br></span><span style="color: #000000;">                </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> numberPerGroup </span><span style="color: #000000;">=</span><span style="color: #000000;"> param.n </span><span style="color: #000000;">/</span><span style="color: #000000;"> param.m; </span><span style="color: #008000;">//</span><span style="color: #008000;">每组图像的数目</span><span style="color: #008000;"><br></span><span style="color: #000000;">                MCvConnectedComp comp;                                  </span><span style="color: #008000;">//</span><span style="color: #008000;">保存Mean Shift计算结果的连接部件</span><span style="color: #008000;"><br></span><span style="color: #000000;">                </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> offsetHistoryImage;                                                     </span><span style="color: #008000;">//</span><span style="color: #008000;">历史图像中某个像素相对图像数据起点的偏移量</span><span style="color: #008000;"><br></span><span style="color: #000000;">                </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> widthStepHistoryImage </span><span style="color: #000000;">=</span><span style="color: #000000;"> historyImages[</span><span style="color: #800080;">0</span><span style="color: #000000;">].MIplImage.widthStep;           </span><span style="color: #008000;">//</span><span style="color: #008000;">历史图像的每行字节数</span><span style="color: #008000;"><br></span><span style="color: #000000;">                </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">*</span><span style="color: #000000;">[] ptrHistoryImages </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">*</span><span style="color: #000000;">[param.n];                              </span><span style="color: #008000;">//</span><span style="color: #008000;">历史图像的数据部分起点数组</span><span style="color: #008000;"><br></span><span style="color: #000000;">                </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">*</span><span style="color: #000000;"> ptrSampleImage </span><span style="color: #000000;">=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">*</span><span style="color: #000000;">)sampleImage.MIplImage.imageData.ToPointer();  </span><span style="color: #008000;">//</span><span style="color: #008000;">样本图像的数据部分起点</span><span style="color: #008000;"><br></span><span style="color: #000000;">                </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> offsetConvergenceImage;                                                 </span><span style="color: #008000;">//</span><span style="color: #008000;">收敛图像中某个像素相对图像数据起点的偏移量</span><span style="color: #008000;"><br></span><span style="color: #000000;">                </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> widthStepConvergenceImage </span><span style="color: #000000;">=</span><span style="color: #000000;"> convergenceImages[</span><span style="color: #800080;">0</span><span style="color: #000000;">].MIplImage.widthStep;   </span><span style="color: #008000;">//</span><span style="color: #008000;">收敛图像的每行字节数</span><span style="color: #008000;"><br></span><span style="color: #000000;">                </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">*</span><span style="color: #000000;">[] ptrConvergenceImages </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">*</span><span style="color: #000000;">[param.m];                          </span><span style="color: #008000;">//</span><span style="color: #008000;">收敛图像的数据部分起点数组</span><span style="color: #008000;"><br></span><span style="color: #000000;">                </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> param.n; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                    ptrHistoryImages[i] </span><span style="color: #000000;">=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">*</span><span style="color: #000000;">)historyImages[i].MIplImage.imageData.ToPointer();<br>                </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> param.m; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                    ptrConvergenceImages[i] </span><span style="color: #000000;">=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">*</span><span style="color: #000000;">)convergenceImages[i].MIplImage.imageData.ToPointer();<br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">遍历图像的每一行</span><span style="color: #008000;"><br></span><span style="color: #000000;">                </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> row </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; row </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> height; row</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                {<br>                    </span><span style="color: #008000;">//</span><span style="color: #008000;">遍历图像的每一列</span><span style="color: #008000;"><br></span><span style="color: #000000;">                    </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> col </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; col </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> width; col</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                    {<br>                        offsetHistoryImage </span><span style="color: #000000;">=</span><span style="color: #000000;"> row </span><span style="color: #000000;">*</span><span style="color: #000000;"> widthStepHistoryImage </span><span style="color: #000000;">+</span><span style="color: #000000;"> col </span><span style="color: #000000;">*</span><span style="color: #000000;"> </span><span style="color: #800080;">3</span><span style="color: #000000;">;<br>                        offsetConvergenceImage </span><span style="color: #000000;">=</span><span style="color: #000000;"> row </span><span style="color: #000000;">*</span><span style="color: #000000;"> widthStepConvergenceImage </span><span style="color: #000000;">+</span><span style="color: #000000;"> col </span><span style="color: #000000;">*</span><span style="color: #000000;"> </span><span style="color: #800080;">3</span><span style="color: #000000;">;<br>                        </span><span style="color: #008000;">//</span><span style="color: #008000;">用历史图像在该点的Y通道值组成一副用于Mean Shift计算的样本图像</span><span style="color: #008000;"><br></span><span style="color: #000000;">                        </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> sampleIdx </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; sampleIdx </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> param.n; sampleIdx</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                            </span><span style="color: #000000;">*</span><span style="color: #000000;">(ptrSampleImage </span><span style="color: #000000;">+</span><span style="color: #000000;"> sampleIdx) </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #000000;">*</span><span style="color: #000000;">(ptrHistoryImages[sampleIdx] </span><span style="color: #000000;">+</span><span style="color: #000000;"> offsetHistoryImage);<br>                        </span><span style="color: #008000;">//</span><span style="color: #008000;">以每组的位置为矩形窗的起点，用MeanShift过程找到局部极值，由局部极值组成的图像是收敛图像</span><span style="color: #008000;"><br></span><span style="color: #000000;">                        </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> representativeIdx </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; representativeIdx </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> param.m; representativeIdx</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                        {<br>                            Rectangle window </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Rectangle(representativeIdx </span><span style="color: #000000;">*</span><span style="color: #000000;"> numberPerGroup, </span><span style="color: #800080;">0</span><span style="color: #000000;">, numberPerGroup, </span><span style="color: #800080;">1</span><span style="color: #000000;">);<br>                            CvInvoke.cvMeanShift(sampleImage.Ptr, window, param.criteria, </span><span style="color: #0000ff;">out</span><span style="color: #000000;"> comp);<br>                            </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> center </span><span style="color: #000000;">=</span><span style="color: #000000;"> comp.rect.Left </span><span style="color: #000000;">+</span><span style="color: #000000;"> comp.rect.Width </span><span style="color: #000000;">/</span><span style="color: #000000;"> </span><span style="color: #800080;">2</span><span style="color: #000000;">;      </span><span style="color: #008000;">//</span><span style="color: #008000;">收敛中心</span><span style="color: #008000;"><br></span><span style="color: #000000;">                            </span><span style="color: #000000;">*</span><span style="color: #000000;">(ptrConvergenceImages[representativeIdx] </span><span style="color: #000000;">+</span><span style="color: #000000;"> offsetConvergenceImage) </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #000000;">*</span><span style="color: #000000;">(ptrHistoryImages[center] </span><span style="color: #000000;">+</span><span style="color: #000000;"> offsetHistoryImage);<br>                            </span><span style="color: #000000;">*</span><span style="color: #000000;">(ptrConvergenceImages[representativeIdx] </span><span style="color: #000000;">+</span><span style="color: #000000;"> offsetConvergenceImage </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;">) </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #000000;">*</span><span style="color: #000000;">(ptrHistoryImages[center] </span><span style="color: #000000;">+</span><span style="color: #000000;"> offsetHistoryImage </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;">);<br>                            </span><span style="color: #000000;">*</span><span style="color: #000000;">(ptrConvergenceImages[representativeIdx] </span><span style="color: #000000;">+</span><span style="color: #000000;"> offsetConvergenceImage </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800080;">2</span><span style="color: #000000;">) </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #000000;">*</span><span style="color: #000000;">(ptrHistoryImages[center] </span><span style="color: #000000;">+</span><span style="color: #000000;"> offsetHistoryImage </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800080;">2</span><span style="color: #000000;">);<br>                        }<br>                    }<br>                }<br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">2.将近似的收敛点分类，以得到聚集中心<br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">（1）得到收敛中心的最小值Cmin；（2）将[0 , Cmin+t]区间中的收敛中心划为一类；（3）计算已分类点的平均值，作为聚集中心的值，并将聚集中心添加到clusterCenters；（4）删除已分类的收敛中心；（5）重复（0）～（4）直到收敛中心全部归类。</span><span style="color: #008000;"><br></span><span style="color: #000000;">                </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> row </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; row </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> height; row</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                {<br>                    </span><span style="color: #008000;">//</span><span style="color: #008000;">遍历图像的每一列</span><span style="color: #008000;"><br></span><span style="color: #000000;">                    </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> col </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; col </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> width; col</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                    {<br>                        offsetConvergenceImage </span><span style="color: #000000;">=</span><span style="color: #000000;"> row </span><span style="color: #000000;">*</span><span style="color: #000000;"> widthStepConvergenceImage </span><span style="color: #000000;">+</span><span style="color: #000000;"> col </span><span style="color: #000000;">*</span><span style="color: #000000;"> </span><span style="color: #800080;">3</span><span style="color: #000000;">;<br>                        </span><span style="color: #008000;">//</span><span style="color: #008000;">得到该像素的收敛中心列表</span><span style="color: #008000;"><br></span><span style="color: #000000;">                        List</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> convergenceCenters </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> List</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">(param.m);<br>                        </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> convergenceIdx </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; convergenceIdx </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> param.m; convergenceIdx</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                            convergenceCenters.Add(</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Ycc(</span><span style="color: #000000;">*</span><span style="color: #000000;">(ptrConvergenceImages[convergenceIdx] </span><span style="color: #000000;">+</span><span style="color: #000000;"> offsetConvergenceImage), </span><span style="color: #000000;">*</span><span style="color: #000000;">(ptrConvergenceImages[convergenceIdx] </span><span style="color: #000000;">+</span><span style="color: #000000;"> offsetConvergenceImage </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;">), </span><span style="color: #000000;">*</span><span style="color: #000000;">(ptrConvergenceImages[convergenceIdx] </span><span style="color: #000000;">+</span><span style="color: #000000;"> offsetConvergenceImage </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800080;">2</span><span style="color: #000000;">)));<br>                        </span><span style="color: #0000ff;">while</span><span style="color: #000000;"> (convergenceCenters.Count </span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">)<br>                        {<br>                            Ycc Cmin </span><span style="color: #000000;">=</span><span style="color: #000000;"> MinYcc(convergenceCenters);<br>                            </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> regionHigh </span><span style="color: #000000;">=</span><span style="color: #000000;"> Cmin.Y </span><span style="color: #000000;">+</span><span style="color: #000000;"> param.t;<br>                            Ycc sum </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Ycc(0d, 0d, 0d);<br>                            </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> li </span><span style="color: #000000;">=</span><span style="color: #000000;"> 0d;<br>                            </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> convergenceCenters.Count </span><span style="color: #000000;">-</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;">; i </span><span style="color: #000000;">&gt;=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i</span><span style="color: #000000;">--</span><span style="color: #000000;">)<br>                            {<br>                                Ycc ci </span><span style="color: #000000;">=</span><span style="color: #000000;"> convergenceCenters[i];<br>                                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (ci.Y </span><span style="color: #000000;">&lt;=</span><span style="color: #000000;"> regionHigh)<br>                                {<br>                                    sum.Y </span><span style="color: #000000;">+=</span><span style="color: #000000;"> ci.Y;<br>                                    sum.Cr </span><span style="color: #000000;">+=</span><span style="color: #000000;"> ci.Cr;<br>                                    sum.Cb </span><span style="color: #000000;">+=</span><span style="color: #000000;"> ci.Cb;<br>                                    li</span><span style="color: #000000;">++</span><span style="color: #000000;">;<br>                                    convergenceCenters.RemoveAt(i);<br>                                }<br>                            }<br>                            Ycc avg </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Ycc(sum.Y </span><span style="color: #000000;">/</span><span style="color: #000000;"> li, sum.Cr </span><span style="color: #000000;">/</span><span style="color: #000000;"> li, sum.Cb </span><span style="color: #000000;">/</span><span style="color: #000000;"> li);<br>                            </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> wi </span><span style="color: #000000;">=</span><span style="color: #000000;"> li </span><span style="color: #000000;">/</span><span style="color: #000000;"> param.m;<br>                            ClusterCenter</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> clusterCenter </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> ClusterCenter</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">(avg, wi, li, 0d);<br>                            clusterCenters[row, col].Add(clusterCenter);<br>                        }<br>                    }<br>                }<br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">3.得到最可靠背景模型</span><span style="color: #008000;"><br></span><span style="color: #000000;">                GetMrbm();<br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">4.释放资源</span><span style="color: #008000;"><br></span><span style="color: #000000;">                </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> param.m; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                    convergenceImages[i].Dispose();<br>                convergenceImages.Clear();<br>                success </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">true</span><span style="color: #000000;">;<br>            }<br>            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> success;<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 训练背景模型（没有使用指针运算进行优化，用于演示流程）<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;returns&gt;</span><span style="color: #008000;">返回训练是否成功</span><span style="color: #808080;">&lt;/returns&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> TrainBackgroundModel2()<br>        {<br>            </span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> success </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">false</span><span style="color: #000000;">;<br>            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (historyImages.Count </span><span style="color: #000000;">&gt;=</span><span style="color: #000000;"> param.n)<br>            {<br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">0.初始化收敛图像，个数为param.m</span><span style="color: #008000;"><br></span><span style="color: #000000;">                List</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;"> convergenceImages </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> List</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;">(param.m);<br>                </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> param.m; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                    convergenceImages.Add(</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">(width, height));<br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">1.将历史图像分为m组，以每组的位置为矩形窗的起点，对通道Y在历史图像中进行MeanShift计算，结果窗的中点为收敛中心，该中心的值为收敛值，将收敛值加入到convergenceImageData中。</span><span style="color: #008000;"><br></span><span style="color: #000000;">                </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> numberPerGroup </span><span style="color: #000000;">=</span><span style="color: #000000;"> param.n </span><span style="color: #000000;">/</span><span style="color: #000000;"> param.m; </span><span style="color: #008000;">//</span><span style="color: #008000;">每组图像的数目</span><span style="color: #008000;"><br></span><span style="color: #000000;">                MCvConnectedComp comp;                                  </span><span style="color: #008000;">//</span><span style="color: #008000;">保存Mean Shift计算结果的连接部件<br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">遍历图像的每一行</span><span style="color: #008000;"><br></span><span style="color: #000000;">                </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> row </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; row </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> height; row</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                {<br>                    </span><span style="color: #008000;">//</span><span style="color: #008000;">遍历图像的每一列</span><span style="color: #008000;"><br></span><span style="color: #000000;">                    </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> col </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; col </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> width; col</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                    {<br>                        </span><span style="color: #008000;">//</span><span style="color: #008000;">用历史图像在该点的Y通道值组成一副用于Mean Shift计算的样本图像</span><span style="color: #008000;"><br></span><span style="color: #000000;">                        </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> sampleIdx </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; sampleIdx </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> param.n; sampleIdx</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                            sampleImage[</span><span style="color: #800080;">0</span><span style="color: #000000;">, sampleIdx] </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Gray(historyImages[sampleIdx][row, col].Y);  </span><span style="color: #008000;">//</span><span style="color: #008000;">这里可以用指针优化访问像素的速度<br>                        </span><span style="color: #008000;">//</span><span style="color: #008000;">以每组的位置为矩形窗的起点，用MeanShift过程找到局部极值，由局部极值组成的图像是收敛图像</span><span style="color: #008000;"><br></span><span style="color: #000000;">                        </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> representativeIdx </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; representativeIdx </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> param.m; representativeIdx</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                        {<br>                            Rectangle window </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Rectangle(representativeIdx </span><span style="color: #000000;">*</span><span style="color: #000000;"> numberPerGroup, </span><span style="color: #800080;">0</span><span style="color: #000000;">, numberPerGroup, </span><span style="color: #800080;">1</span><span style="color: #000000;">);<br>                            CvInvoke.cvMeanShift(sampleImage.Ptr, window, param.criteria, </span><span style="color: #0000ff;">out</span><span style="color: #000000;"> comp);<br>                            </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> center </span><span style="color: #000000;">=</span><span style="color: #000000;"> comp.rect.Left </span><span style="color: #000000;">+</span><span style="color: #000000;"> comp.rect.Width </span><span style="color: #000000;">/</span><span style="color: #000000;"> </span><span style="color: #800080;">2</span><span style="color: #000000;">;      </span><span style="color: #008000;">//</span><span style="color: #008000;">收敛中心</span><span style="color: #008000;"><br></span><span style="color: #000000;">                            Ycc ci </span><span style="color: #000000;">=</span><span style="color: #000000;"> historyImages[center][row, col];               </span><span style="color: #008000;">//</span><span style="color: #008000;">收敛中心对应的像素值</span><span style="color: #008000;"><br></span><span style="color: #000000;">                            convergenceImages[representativeIdx][row, col] </span><span style="color: #000000;">=</span><span style="color: #000000;"> ci;    </span><span style="color: #008000;">//</span><span style="color: #008000;">将收敛中心添加到收敛图像数据中去（这两句可以用指针优化访问像素的速度）</span><span style="color: #008000;"><br></span><span style="color: #000000;">                        }<br>                    }<br>                }<br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">2.将近似的收敛点分类，以得到聚集中心<br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">（1）得到收敛中心的最小值Cmin；（2）将[0 , Cmin+t]区间中的收敛中心划为一类；（3）计算已分类点的平均值，作为聚集中心的值，并将聚集中心添加到clusterCenters；（4）删除已分类的收敛中心；（5）重复（0）～（4）直到收敛中心全部归类。</span><span style="color: #008000;"><br></span><span style="color: #000000;">                </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> row </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; row </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> height; row</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                {<br>                    </span><span style="color: #008000;">//</span><span style="color: #008000;">遍历图像的每一列</span><span style="color: #008000;"><br></span><span style="color: #000000;">                    </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> col </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; col </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> width; col</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                    {<br>                        </span><span style="color: #008000;">//</span><span style="color: #008000;">得到该像素的收敛中心列表</span><span style="color: #008000;"><br></span><span style="color: #000000;">                        List</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> convergenceCenters </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> List</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">(param.m);<br>                        </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> convergenceIdx </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; convergenceIdx </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> param.m; convergenceIdx</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                            convergenceCenters.Add(convergenceImages[convergenceIdx][row, col]);<br>                        </span><span style="color: #0000ff;">while</span><span style="color: #000000;"> (convergenceCenters.Count </span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">)<br>                        {<br>                            Ycc Cmin </span><span style="color: #000000;">=</span><span style="color: #000000;"> MinYcc(convergenceCenters);<br>                            </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> regionHigh </span><span style="color: #000000;">=</span><span style="color: #000000;"> Cmin.Y </span><span style="color: #000000;">+</span><span style="color: #000000;"> param.t;<br>                            Ycc sum </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Ycc(0d, 0d, 0d);<br>                            </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> li </span><span style="color: #000000;">=</span><span style="color: #000000;"> 0d;<br>                            </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> convergenceCenters.Count </span><span style="color: #000000;">-</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;">; i </span><span style="color: #000000;">&gt;=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i</span><span style="color: #000000;">--</span><span style="color: #000000;">)<br>                            {<br>                                Ycc ci </span><span style="color: #000000;">=</span><span style="color: #000000;"> convergenceCenters[i];<br>                                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (ci.Y </span><span style="color: #000000;">&lt;=</span><span style="color: #000000;"> regionHigh)<br>                                {<br>                                    sum.Y </span><span style="color: #000000;">+=</span><span style="color: #000000;"> ci.Y;<br>                                    sum.Cr </span><span style="color: #000000;">+=</span><span style="color: #000000;"> ci.Cr;<br>                                    sum.Cb </span><span style="color: #000000;">+=</span><span style="color: #000000;"> ci.Cb;<br>                                    li</span><span style="color: #000000;">++</span><span style="color: #000000;">;<br>                                    convergenceCenters.RemoveAt(i);<br>                                }<br>                            }<br>                            Ycc avg </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Ycc(sum.Y </span><span style="color: #000000;">/</span><span style="color: #000000;"> li, sum.Cr </span><span style="color: #000000;">/</span><span style="color: #000000;"> li, sum.Cb </span><span style="color: #000000;">/</span><span style="color: #000000;"> li);<br>                            </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> wi </span><span style="color: #000000;">=</span><span style="color: #000000;"> li </span><span style="color: #000000;">/</span><span style="color: #000000;"> param.m;<br>                            ClusterCenter</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> clusterCenter </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> ClusterCenter</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">(avg, wi, li, 0d);<br>                            clusterCenters[row, col].Add(clusterCenter);<br>                        }<br>                    }<br>                }<br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">3.得到最可靠背景模型</span><span style="color: #008000;"><br></span><span style="color: #000000;">                GetMrbm();<br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">4.释放资源</span><span style="color: #008000;"><br></span><span style="color: #000000;">                </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> param.m; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                    convergenceImages[i].Dispose();<br>                convergenceImages.Clear();<br>                success </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">true</span><span style="color: #000000;">;<br>            }<br>            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> success;<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 训练背景模型<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="historyImages"&gt;</span><span style="color: #008000;">历史图像数组</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;returns&gt;</span><span style="color: #008000;">返回训练是否成功</span><span style="color: #808080;">&lt;/returns&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> TrainBackgroundModel(Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc,</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">[] historyImages)<br>        {<br>            AddHistoryImage(historyImages);<br>            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> TrainBackgroundModel();<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 训练背景模型<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="historyImages"&gt;</span><span style="color: #008000;">历史图像数组</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;returns&gt;</span><span style="color: #008000;">返回训练是否成功</span><span style="color: #808080;">&lt;/returns&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> TrainBackgroundModel(List</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc,</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;"> historyImages)<br>        {<br>            AddHistoryImage(historyImages);<br>            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> TrainBackgroundModel();<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 训练背景模型<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="historyImages"&gt;</span><span style="color: #008000;">历史图像数组</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;returns&gt;</span><span style="color: #008000;">返回训练是否成功</span><span style="color: #808080;">&lt;/returns&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> TrainBackgroundModel(Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Bgr, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">[] historyImages)<br>        {<br>            AddHistoryImage(historyImages);<br>            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> TrainBackgroundModel();<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 训练背景模型<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="historyImages"&gt;</span><span style="color: #008000;">历史图像数组</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;returns&gt;</span><span style="color: #008000;">返回训练是否成功</span><span style="color: #808080;">&lt;/returns&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">bool</span><span style="color: #000000;"> TrainBackgroundModel(List</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Bgr, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;"> historyImages)<br>        {<br>            AddHistoryImage(historyImages);<br>            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> TrainBackgroundModel();<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 得到Ycc列表中的最小值（仅比较Y分量）<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="yccList"&gt;&lt;/param&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;returns&gt;&lt;/returns&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> Ycc MinYcc(List</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> yccList)<br>        {<br>            Ycc min </span><span style="color: #000000;">=</span><span style="color: #000000;"> yccList[</span><span style="color: #800080;">0</span><span style="color: #000000;">];<br>            </span><span style="color: #0000ff;">foreach</span><span style="color: #000000;"> (Ycc ycc </span><span style="color: #0000ff;">in</span><span style="color: #000000;"> yccList)<br>            {<br>                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (ycc.Y </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> min.Y)<br>                    min </span><span style="color: #000000;">=</span><span style="color: #000000;"> ycc;<br>            }<br>            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> min;<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 得到聚集中心列表中的最大值（比较wi）<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="clusterCenters"&gt;&lt;/param&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;returns&gt;&lt;/returns&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> ClusterCenter</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> MaxClusterCenter(List</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">ClusterCenter</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc</span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;"> clusterCenters)<br>        {<br>            ClusterCenter</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> max </span><span style="color: #000000;">=</span><span style="color: #000000;"> clusterCenters[</span><span style="color: #800080;">0</span><span style="color: #000000;">];<br>            </span><span style="color: #0000ff;">foreach</span><span style="color: #000000;"> (ClusterCenter</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> center </span><span style="color: #0000ff;">in</span><span style="color: #000000;"> clusterCenters)<br>            {<br>                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (center.wi </span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> max.wi)<br>                    max </span><span style="color: #000000;">=</span><span style="color: #000000;"> center;<br>            }<br>            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> max;<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 得到最可靠背景模型MRBM：在聚集中心选择wi最大的值（没有使用指针运算进行优化，用于演示流程）<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> GetMrbm2()<br>        {<br>            </span><span style="color: #008000;">//</span><span style="color: #008000;">遍历图像的每一行</span><span style="color: #008000;"><br></span><span style="color: #000000;">            </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> row </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; row </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> height; row</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>            {<br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">遍历图像的每一列</span><span style="color: #008000;"><br></span><span style="color: #000000;">                </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> col </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; col </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> width; col</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                    mrbm[row, col] </span><span style="color: #000000;">=</span><span style="color: #000000;"> MaxClusterCenter(clusterCenters[row, col]).ci;<br>            }<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 得到最可靠背景模型MRBM：在聚集中心选择wi最大的值<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">unsafe</span><span style="color: #000000;"> </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> GetMrbm()<br>        {<br>            </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> widthStepMrbm </span><span style="color: #000000;">=</span><span style="color: #000000;"> mrbm.MIplImage.widthStep;<br>            </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">*</span><span style="color: #000000;"> ptrMrbm </span><span style="color: #000000;">=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">*</span><span style="color: #000000;">)mrbm.MIplImage.imageData.ToPointer();<br>            </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">*</span><span style="color: #000000;"> ptrPixel;<br>            Ycc ci;<br>            </span><span style="color: #008000;">//</span><span style="color: #008000;">遍历图像的每一行</span><span style="color: #008000;"><br></span><span style="color: #000000;">            </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> row </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; row </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> height; row</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>            {<br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">遍历图像的每一列</span><span style="color: #008000;"><br></span><span style="color: #000000;">                </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> col </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; col </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> width; col</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                {<br>                    ci </span><span style="color: #000000;">=</span><span style="color: #000000;"> MaxClusterCenter(clusterCenters[row, col]).ci;<br>                    ptrPixel </span><span style="color: #000000;">=</span><span style="color: #000000;"> ptrMrbm </span><span style="color: #000000;">+</span><span style="color: #000000;"> row </span><span style="color: #000000;">*</span><span style="color: #000000;"> widthStepMrbm </span><span style="color: #000000;">+</span><span style="color: #000000;"> col </span><span style="color: #000000;">*</span><span style="color: #000000;"> </span><span style="color: #800080;">3</span><span style="color: #000000;">;<br>                    </span><span style="color: #000000;">*</span><span style="color: #000000;">ptrPixel </span><span style="color: #000000;">=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">)ci.Y;<br>                    </span><span style="color: #000000;">*</span><span style="color: #000000;">(ptrPixel </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;">) </span><span style="color: #000000;">=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">)ci.Cr;<br>                    </span><span style="color: #000000;">*</span><span style="color: #000000;">(ptrPixel </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800080;">2</span><span style="color: #000000;">) </span><span style="color: #000000;">=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">)ci.Cb;<br>                }<br>            }<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 更新背景模型，同时计算相应的前景和背景（没有使用指针运算进行优化，用于演示流程）<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="currentFrame"&gt;</span><span style="color: #008000;">当前帧图像</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> Update2(Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> currentFrame)<br>        {<br>            </span><span style="color: #008000;">//</span><span style="color: #008000;">1.将当前帧加入到历史图像的末尾</span><span style="color: #008000;"><br></span><span style="color: #000000;">            AddHistoryImage(currentFrame);<br>            frameCount</span><span style="color: #000000;">++</span><span style="color: #000000;">;<br>            </span><span style="color: #008000;">//</span><span style="color: #008000;">2.将背景掩码图像整个设置为白色，在检测时再将前景像素置零</span><span style="color: #008000;"><br></span><span style="color: #000000;">            backgroundMask.SetValue(255d);<br>            </span><span style="color: #008000;">//</span><span style="color: #008000;">3.遍历图像的每个像素，确定前景或背景；同时进行背景维持操作。</span><span style="color: #008000;"><br></span><span style="color: #000000;">            </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> numberPerGroup </span><span style="color: #000000;">=</span><span style="color: #000000;"> param.n </span><span style="color: #000000;">/</span><span style="color: #000000;"> param.m;<br>            </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> lastIdx </span><span style="color: #000000;">=</span><span style="color: #000000;"> param.n </span><span style="color: #000000;">-</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;">;<br>            </span><span style="color: #008000;">//</span><span style="color: #008000;">遍历图像的每一行</span><span style="color: #008000;"><br></span><span style="color: #000000;">            </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> row </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; row </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> height; row</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>            {<br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">遍历图像的每一列</span><span style="color: #008000;"><br></span><span style="color: #000000;">                </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> col </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; col </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> width; col</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                {<br>                    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> nearestIndex;   </span><span style="color: #008000;">//</span><span style="color: #008000;">最近的聚集中心索引</span><span style="color: #008000;"><br></span><span style="color: #000000;">                    </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> d </span><span style="color: #000000;">=</span><span style="color: #000000;"> GetMinD(historyImages[lastIdx][row, col].Y, clusterCenters[row, col], </span><span style="color: #0000ff;">out</span><span style="color: #000000;"> nearestIndex);    </span><span style="color: #008000;">//</span><span style="color: #008000;">得到最小差值d</span><span style="color: #008000;"><br></span><span style="color: #000000;">                    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (d </span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> param.t)<br>                    {<br>                        </span><span style="color: #008000;">//</span><span style="color: #008000;">该点为前景：以该点附近的矩形窗{n-numberPerGroup,0,numberPerGroup,1}开始进行MeanShift运算，并得到新的收敛中心Cnew（wi=1/m），将Cnew加入到聚集中心clusterCenters<br>                        </span><span style="color: #008000;">//</span><span style="color: #008000;">用历史图像在该点的Y通道值组成一副用于Mean Shift计算的样本图像</span><span style="color: #008000;"><br></span><span style="color: #000000;">                        </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> sampleIdx </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; sampleIdx </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> param.n; sampleIdx</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                            sampleImage[</span><span style="color: #800080;">0</span><span style="color: #000000;">, sampleIdx] </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Gray(historyImages[sampleIdx][row, col].Y);     </span><span style="color: #008000;">//</span><span style="color: #008000;">这里可以用指针运算来提高速度</span><span style="color: #008000;"><br></span><span style="color: #000000;">                        Rectangle window </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Rectangle(param.n </span><span style="color: #000000;">-</span><span style="color: #000000;"> numberPerGroup, </span><span style="color: #800080;">0</span><span style="color: #000000;">, numberPerGroup, </span><span style="color: #800080;">1</span><span style="color: #000000;">);<br>                        MCvConnectedComp comp;<br>                        CvInvoke.cvMeanShift(sampleImage.Ptr, window, param.criteria, </span><span style="color: #0000ff;">out</span><span style="color: #000000;"> comp);<br>                        </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> center </span><span style="color: #000000;">=</span><span style="color: #000000;"> comp.rect.Left </span><span style="color: #000000;">+</span><span style="color: #000000;"> comp.rect.Width </span><span style="color: #000000;">/</span><span style="color: #000000;"> </span><span style="color: #800080;">2</span><span style="color: #000000;">;      </span><span style="color: #008000;">//</span><span style="color: #008000;">收敛中心</span><span style="color: #008000;"><br></span><span style="color: #000000;">                        ClusterCenter</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> cnew </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> ClusterCenter</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">(historyImages[center][row, col], 1d </span><span style="color: #000000;">/</span><span style="color: #000000;"> (param.m </span><span style="color: #000000;">+</span><span style="color: #000000;"> frameCount), 1d, frameCount);  </span><span style="color: #008000;">//</span><span style="color: #008000;">将收敛中心作为新的聚集中心</span><span style="color: #008000;"><br></span><span style="color: #000000;">                        clusterCenters[row, col].Add(cnew);<br>                        </span><span style="color: #008000;">//</span><span style="color: #008000;">设置背景掩码图像的前景点</span><span style="color: #008000;"><br></span><span style="color: #000000;">                        backgroundMask[row, col] </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Gray(0d);<br>                    }<br>                    </span><span style="color: #0000ff;">else</span><span style="color: #000000;"><br>                    {<br>                        </span><span style="color: #008000;">//</span><span style="color: #008000;">该点为背景：更新最近聚集中心的ci为(li+1)/m</span><span style="color: #008000;"><br></span><span style="color: #000000;">                        clusterCenters[row, col][nearestIndex].li</span><span style="color: #000000;">++</span><span style="color: #000000;">;<br>                        clusterCenters[row, col][nearestIndex].wi </span><span style="color: #000000;">=</span><span style="color: #000000;"> clusterCenters[row, col][nearestIndex].li </span><span style="color: #000000;">/</span><span style="color: #000000;"> (param.m </span><span style="color: #000000;">+</span><span style="color: #000000;"> frameCount);<br>                        clusterCenters[row, col][nearestIndex].updateFrameNo </span><span style="color: #000000;">=</span><span style="color: #000000;"> frameCount;<br>                    }<br>                }<br>            }<br>            </span><span style="color: #008000;">//</span><span style="color: #008000;">4.生成最可靠背景模型</span><span style="color: #008000;"><br></span><span style="color: #000000;">            GetMrbm();<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 更新背景模型，同时计算相应的前景和背景<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="currentFrame"&gt;</span><span style="color: #008000;">当前帧图像</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> Update2(Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Bgr, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> currentFrame)<br>        {<br>            Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> image </span><span style="color: #000000;">=</span><span style="color: #000000;"> currentFrame.Convert</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">();<br>            Update(image);<br>            image.Dispose();<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 更新背景模型，同时计算相应的前景和背景<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="currentFrame"&gt;</span><span style="color: #008000;">当前帧图像</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">unsafe</span><span style="color: #000000;"> </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> Update(Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> currentFrame)<br>        {<br>            </span><span style="color: #008000;">//</span><span style="color: #008000;">1.将当前帧加入到历史图像的末尾</span><span style="color: #008000;"><br></span><span style="color: #000000;">            AddHistoryImage(currentFrame);<br>            frameCount</span><span style="color: #000000;">++</span><span style="color: #000000;">;<br>            </span><span style="color: #008000;">//</span><span style="color: #008000;">2.将背景掩码图像整个设置为白色，在检测时再将前景像素置零</span><span style="color: #008000;"><br></span><span style="color: #000000;">            backgroundMask.SetValue(255d);<br>            </span><span style="color: #008000;">//</span><span style="color: #008000;">3.遍历图像的每个像素，确定前景或背景；同时进行背景维持操作。</span><span style="color: #008000;"><br></span><span style="color: #000000;">            </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> numberPerGroup </span><span style="color: #000000;">=</span><span style="color: #000000;"> param.n </span><span style="color: #000000;">/</span><span style="color: #000000;"> param.m;<br>            </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> lastIdx </span><span style="color: #000000;">=</span><span style="color: #000000;"> param.n </span><span style="color: #000000;">-</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;">;<br>            </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> offsetHistoryImage;                                                     </span><span style="color: #008000;">//</span><span style="color: #008000;">历史图像中某个像素相对图像数据起点的偏移量</span><span style="color: #008000;"><br></span><span style="color: #000000;">            </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> widthStepHistoryImage </span><span style="color: #000000;">=</span><span style="color: #000000;"> historyImages[</span><span style="color: #800080;">0</span><span style="color: #000000;">].MIplImage.widthStep;           </span><span style="color: #008000;">//</span><span style="color: #008000;">历史图像的每行字节数</span><span style="color: #008000;"><br></span><span style="color: #000000;">            </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">*</span><span style="color: #000000;">[] ptrHistoryImages </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">*</span><span style="color: #000000;">[param.n];                              </span><span style="color: #008000;">//</span><span style="color: #008000;">历史图像的数据部分起点数组</span><span style="color: #008000;"><br></span><span style="color: #000000;">            </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">*</span><span style="color: #000000;"> ptrSampleImage </span><span style="color: #000000;">=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">*</span><span style="color: #000000;">)sampleImage.MIplImage.imageData.ToPointer();  </span><span style="color: #008000;">//</span><span style="color: #008000;">样本图像的数据部分起点</span><span style="color: #008000;"><br></span><span style="color: #000000;">            </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> widthStepBackgroundMask </span><span style="color: #000000;">=</span><span style="color: #000000;"> backgroundMask.MIplImage.widthStep;           </span><span style="color: #008000;">//</span><span style="color: #008000;">背景掩码图像的每行字节数</span><span style="color: #008000;"><br></span><span style="color: #000000;">            </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">*</span><span style="color: #000000;"> ptrBackgroundMask </span><span style="color: #000000;">=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">*</span><span style="color: #000000;">)backgroundMask.MIplImage.imageData.ToPointer();  </span><span style="color: #008000;">//</span><span style="color: #008000;">背景掩码图像的数据部分起点</span><span style="color: #008000;"><br></span><span style="color: #000000;">            </span><span style="color: #0000ff;">byte</span><span style="color: #000000;"> f </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">;                                                                 </span><span style="color: #008000;">//</span><span style="color: #008000;">前景对应的颜色值</span><span style="color: #008000;"><br></span><span style="color: #000000;">            </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> i </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; i </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> param.n; i</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                ptrHistoryImages[i] </span><span style="color: #000000;">=</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">byte</span><span style="color: #000000;">*</span><span style="color: #000000;">)historyImages[i].MIplImage.imageData.ToPointer();<br>            </span><span style="color: #008000;">//</span><span style="color: #008000;">遍历图像的每一行</span><span style="color: #008000;"><br></span><span style="color: #000000;">            </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> row </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; row </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> height; row</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>            {<br>                </span><span style="color: #008000;">//</span><span style="color: #008000;">遍历图像的每一列</span><span style="color: #008000;"><br></span><span style="color: #000000;">                </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> col </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; col </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> width; col</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                {<br>                    offsetHistoryImage </span><span style="color: #000000;">=</span><span style="color: #000000;"> row </span><span style="color: #000000;">*</span><span style="color: #000000;"> widthStepHistoryImage </span><span style="color: #000000;">+</span><span style="color: #000000;"> col </span><span style="color: #000000;">*</span><span style="color: #000000;"> </span><span style="color: #800080;">3</span><span style="color: #000000;">;<br>                    </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> nearestIndex;   </span><span style="color: #008000;">//</span><span style="color: #008000;">最近的聚集中心索引</span><span style="color: #008000;"><br></span><span style="color: #000000;">                    </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> d </span><span style="color: #000000;">=</span><span style="color: #000000;"> GetMinD((</span><span style="color: #0000ff;">double</span><span style="color: #000000;">)(</span><span style="color: #000000;">*</span><span style="color: #000000;">(ptrHistoryImages[lastIdx] </span><span style="color: #000000;">+</span><span style="color: #000000;"> offsetHistoryImage)), clusterCenters[row, col], </span><span style="color: #0000ff;">out</span><span style="color: #000000;"> nearestIndex);    </span><span style="color: #008000;">//</span><span style="color: #008000;">得到最小差值d</span><span style="color: #008000;"><br></span><span style="color: #000000;">                    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (d </span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> param.t)<br>                    {<br>                        </span><span style="color: #008000;">//</span><span style="color: #008000;">该点为前景：以该点附近的矩形窗{n-numberPerGroup,0,numberPerGroup,1}开始进行MeanShift运算，并得到新的收敛中心Cnew（wi=1/m），将Cnew加入到聚集中心clusterCenters<br>                        </span><span style="color: #008000;">//</span><span style="color: #008000;">用历史图像在该点的Y通道值组成一副用于Mean Shift计算的样本图像</span><span style="color: #008000;"><br></span><span style="color: #000000;">                        </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> sampleIdx </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; sampleIdx </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> param.n; sampleIdx</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                            </span><span style="color: #000000;">*</span><span style="color: #000000;">(ptrSampleImage </span><span style="color: #000000;">+</span><span style="color: #000000;"> sampleIdx) </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #000000;">*</span><span style="color: #000000;">(ptrHistoryImages[sampleIdx] </span><span style="color: #000000;">+</span><span style="color: #000000;"> offsetHistoryImage);<br>                        Rectangle window </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Rectangle(param.n </span><span style="color: #000000;">-</span><span style="color: #000000;"> numberPerGroup, </span><span style="color: #800080;">0</span><span style="color: #000000;">, numberPerGroup, </span><span style="color: #800080;">1</span><span style="color: #000000;">);<br>                        MCvConnectedComp comp;<br>                        CvInvoke.cvMeanShift(sampleImage.Ptr, window, param.criteria, </span><span style="color: #0000ff;">out</span><span style="color: #000000;"> comp);<br>                        </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> center </span><span style="color: #000000;">=</span><span style="color: #000000;"> comp.rect.Left </span><span style="color: #000000;">+</span><span style="color: #000000;"> comp.rect.Width </span><span style="color: #000000;">/</span><span style="color: #000000;"> </span><span style="color: #800080;">2</span><span style="color: #000000;">;      </span><span style="color: #008000;">//</span><span style="color: #008000;">收敛中心</span><span style="color: #008000;"><br></span><span style="color: #000000;">                        ClusterCenter</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> cnew </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> ClusterCenter</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">(historyImages[center][row, col], 1d </span><span style="color: #000000;">/</span><span style="color: #000000;"> (param.m </span><span style="color: #000000;">+</span><span style="color: #000000;"> frameCount), 1d, frameCount);  </span><span style="color: #008000;">//</span><span style="color: #008000;">将收敛中心作为新的聚集中心</span><span style="color: #008000;"><br></span><span style="color: #000000;">                        clusterCenters[row, col].Add(cnew);<br>                        </span><span style="color: #008000;">//</span><span style="color: #008000;">设置背景掩码图像的前景点</span><span style="color: #008000;"><br></span><span style="color: #000000;">                        </span><span style="color: #000000;">*</span><span style="color: #000000;">(ptrBackgroundMask </span><span style="color: #000000;">+</span><span style="color: #000000;"> row </span><span style="color: #000000;">*</span><span style="color: #000000;"> widthStepBackgroundMask </span><span style="color: #000000;">+</span><span style="color: #000000;"> col) </span><span style="color: #000000;">=</span><span style="color: #000000;"> f;<br>                    }<br>                    </span><span style="color: #0000ff;">else</span><span style="color: #000000;"><br>                    {<br>                        </span><span style="color: #008000;">//</span><span style="color: #008000;">该点为背景：更新最近聚集中心的ci为(li+1)/m</span><span style="color: #008000;"><br></span><span style="color: #000000;">                        clusterCenters[row, col][nearestIndex].li</span><span style="color: #000000;">++</span><span style="color: #000000;">;<br>                        clusterCenters[row, col][nearestIndex].wi </span><span style="color: #000000;">=</span><span style="color: #000000;"> clusterCenters[row, col][nearestIndex].li </span><span style="color: #000000;">/</span><span style="color: #000000;"> (param.m </span><span style="color: #000000;">+</span><span style="color: #000000;"> frameCount);<br>                        clusterCenters[row, col][nearestIndex].updateFrameNo </span><span style="color: #000000;">=</span><span style="color: #000000;"> frameCount;<br>                    }<br>                }<br>            }<br>            </span><span style="color: #008000;">//</span><span style="color: #008000;">4.生成最可靠背景模型</span><span style="color: #008000;"><br></span><span style="color: #000000;">            GetMrbm();<br>        }<br><br>        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> Update(Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Bgr, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> currentFrame)<br>        {<br>            Image</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> image </span><span style="color: #000000;">=</span><span style="color: #000000;"> currentFrame.Convert</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc, </span><span style="color: #0000ff;">byte</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">();<br>            Update(image);<br>            image.Dispose();<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 用wi&gt;=theta作为条件选择可能的背景模型Cb；对每个观测值x0，计算x0与Cb的最小差值d<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="x0"&gt;</span><span style="color: #008000;">观测值x0</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="centerList"&gt;</span><span style="color: #008000;">某像素对应的聚集中心列表</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="nearestIndex"&gt;</span><span style="color: #008000;">输出参数：最近的聚集中心索引</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;returns&gt;</span><span style="color: #008000;">返回最小差值d</span><span style="color: #808080;">&lt;/returns&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">private</span><span style="color: #000000;"> </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> GetMinD(</span><span style="color: #0000ff;">double</span><span style="color: #000000;"> x0, List</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">ClusterCenter</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc</span><span style="color: #000000;">&gt;&gt;</span><span style="color: #000000;"> centerList, </span><span style="color: #0000ff;">out</span><span style="color: #000000;"> </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> nearestIndex)<br>        {<br>            </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> d </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000ff;">double</span><span style="color: #000000;">.MaxValue;<br>            nearestIndex </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">;<br>            </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> idx </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; idx </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> centerList.Count; idx</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>            {<br>                ClusterCenter</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">Ycc</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> center </span><span style="color: #000000;">=</span><span style="color: #000000;"> centerList[idx];<br>                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (center.wi </span><span style="color: #000000;">&gt;=</span><span style="color: #000000;"> param.theta)<br>                {<br>                    </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> d0 </span><span style="color: #000000;">=</span><span style="color: #000000;"> Math.Abs(center.ci.Y </span><span style="color: #000000;">-</span><span style="color: #000000;"> x0);<br>                    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (d0 </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> d)<br>                    {<br>                        d </span><span style="color: #000000;">=</span><span style="color: #000000;"> d0;<br>                        nearestIndex </span><span style="color: #000000;">=</span><span style="color: #000000;"> idx;<br>                    }<br>                }<br>            }<br>            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> d;<br>        }<br><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> 清除不活跃的聚集中心<br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>        </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;param name="staleThresh"&gt;</span><span style="color: #008000;">不活跃阀值，不活跃帧数大于该值的聚集中心将被清除</span><span style="color: #808080;">&lt;/param&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">void</span><span style="color: #000000;"> ClearStale(</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> staleThresh)<br>        {<br>            </span><span style="color: #008000;">//</span><span style="color: #008000;">遍历每个像素的聚集中心</span><span style="color: #008000;"><br></span><span style="color: #000000;">            </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> row </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; row </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> height; row</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>            {<br>                </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> col </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; col </span><span style="color: #000000;">&lt;</span><span style="color: #000000;"> width; col</span><span style="color: #000000;">++</span><span style="color: #000000;">)<br>                {<br>                    </span><span style="color: #0000ff;">for</span><span style="color: #000000;"> (</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> idx </span><span style="color: #000000;">=</span><span style="color: #000000;"> clusterCenters[row, col].Count </span><span style="color: #000000;">-</span><span style="color: #000000;"> </span><span style="color: #800080;">1</span><span style="color: #000000;">; idx </span><span style="color: #000000;">&gt;=</span><span style="color: #000000;"> </span><span style="color: #800080;">0</span><span style="color: #000000;">; idx</span><span style="color: #000000;">--</span><span style="color: #000000;">)<br>                    {<br>                        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (frameCount </span><span style="color: #000000;">-</span><span style="color: #000000;"> clusterCenters[row, col][idx].updateFrameNo </span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> staleThresh)<br>                            clusterCenters[row, col].RemoveAt(idx);<br>                    }<br>                }<br>            }<br>        }<br><br>    }<br><br>    </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>    </span><span style="color: #808080;">///</span><span style="color: #008000;"> 聚集中心<br>    </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #008000;"><br>    </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;typeparam name="TColor"&gt;</span><span style="color: #008000;">聚集中心使用的色彩空间</span><span style="color: #808080;">&lt;/typeparam&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">class</span><span style="color: #000000;"> ClusterCenter</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">TColor</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br>        </span><span style="color: #0000ff;">where</span><span style="color: #000000;"> TColor : </span><span style="color: #0000ff;">struct</span><span style="color: #000000;">, IColor<br>    {<br>        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> TColor ci;              </span><span style="color: #008000;">//</span><span style="color: #008000;">聚集中心的像素值</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> wi;              </span><span style="color: #008000;">//</span><span style="color: #008000;">聚集中心的权重</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> li;              </span><span style="color: #008000;">//</span><span style="color: #008000;">聚集中心包含的收敛点数目</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> updateFrameNo;   </span><span style="color: #008000;">//</span><span style="color: #008000;">更新该聚集中心时的帧数：用于消除消极的聚集中心</span><span style="color: #008000;"><br></span><span style="color: #000000;"><br>        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> ClusterCenter(TColor ci, </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> wi, </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> li, </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> updateFrameNo)<br>        {<br>            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.ci </span><span style="color: #000000;">=</span><span style="color: #000000;"> ci;<br>            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.li </span><span style="color: #000000;">=</span><span style="color: #000000;"> li;<br>            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.wi </span><span style="color: #000000;">=</span><span style="color: #000000;"> wi;<br>            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.updateFrameNo </span><span style="color: #000000;">=</span><span style="color: #000000;"> updateFrameNo;<br>        }<br>    }<br><br>    </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;summary&gt;</span><span style="color: #008000;"><br>    </span><span style="color: #808080;">///</span><span style="color: #008000;"> 非参数背景模型的参数<br>    </span><span style="color: #808080;">///</span><span style="color: #008000;"> </span><span style="color: #808080;">&lt;/summary&gt;</span><span style="color: #808080;"><br></span><span style="color: #000000;">    </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">struct</span><span style="color: #000000;"> NBGParameter<br>    {<br>        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> n;                       </span><span style="color: #008000;">//</span><span style="color: #008000;">样本数目：需要被保留的历史图像数目</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> m;                       </span><span style="color: #008000;">//</span><span style="color: #008000;">典型点数目：历史图像需要被分为多少组</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> theta;                </span><span style="color: #008000;">//</span><span style="color: #008000;">权重系数：权重大于该值的聚集中心为候选背景</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> t;                    </span><span style="color: #008000;">//</span><span style="color: #008000;">最小差值：观测值与候选背景的最小差值大于该值时，为前景；否则为背景</span><span style="color: #008000;"><br></span><span style="color: #000000;">        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> MCvTermCriteria criteria;    </span><span style="color: #008000;">//</span><span style="color: #008000;">Mean Shift计算的终止条件：包括最大迭代次数和终止计算的精度</span><span style="color: #008000;"><br></span><span style="color: #000000;"><br>        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> NBGParameter(</span><span style="color: #0000ff;">int</span><span style="color: #000000;"> n, </span><span style="color: #0000ff;">int</span><span style="color: #000000;"> m, </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> theta, </span><span style="color: #0000ff;">double</span><span style="color: #000000;"> t, MCvTermCriteria criteria)<br>        {<br>            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.n </span><span style="color: #000000;">=</span><span style="color: #000000;"> n;<br>            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.m </span><span style="color: #000000;">=</span><span style="color: #000000;"> m;<br>            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.theta </span><span style="color: #000000;">=</span><span style="color: #000000;"> theta;<br>            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.t </span><span style="color: #000000;">=</span><span style="color: #000000;"> t;<br>            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.criteria.type </span><span style="color: #000000;">=</span><span style="color: #000000;"> criteria.type;<br>            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.criteria.max_iter </span><span style="color: #000000;">=</span><span style="color: #000000;"> criteria.max_iter;<br>            </span><span style="color: #0000ff;">this</span><span style="color: #000000;">.criteria.epsilon </span><span style="color: #000000;">=</span><span style="color: #000000;"> criteria.epsilon;<br>        }<br><br>        </span><span style="color: #0000ff;">public</span><span style="color: #000000;"> </span><span style="color: #0000ff;">static</span><span style="color: #000000;"> NBGParameter GetDefaultNBGParameter()<br>        {<br>            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> NBGParameter(</span><span style="color: #800080;">100</span><span style="color: #000000;">, </span><span style="color: #800080;">10</span><span style="color: #000000;">, </span><span style="color: #800080;">0.3d</span><span style="color: #000000;">, 10d, </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> MCvTermCriteria(</span><span style="color: #800080;">100</span><span style="color: #000000;">, 1d));<br>        }<br>    }<br>}<br></span></div></pre>
<div class="cnblogs_code_toolbar"><span class="cnblogs_code_copy"><a href="javascript:void(0);" onclick="copyCnblogsCode(this)" title="复制代码"><img src="./背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园_files/copycode.gif" alt="复制代码"></a></span></div></div>
</div>
<p>&nbsp;</p>
<p></p>
<p><b>3 NBGModel类介绍</b><br>&nbsp;&nbsp;&nbsp; <b>3.1 属性</b><br>Width——获取图像的宽度<br>Height——获取图像的高度<br>Param——获取参数设置<br>Mrbm——获取最可靠背景模型图像<br>BackgroundMask——获取背景掩码图像<br>ForegroundMask——获取前景掩码图像<br>FrameCount——获取已被检测的帧数</p>
<p>&nbsp;&nbsp;&nbsp; <b>3.2 构造函数</b><br>public NBGModel(int width, int height)——用默认的参数初始化NBGModel，等价于NBGModel(width, height, NBGParameter.GetDefaultNBGParameter())<br>public NBGModel(int width, int height, NBGParameter param)——用指定的参数初始化NBGModel</p>
<p>&nbsp;&nbsp;&nbsp; <b>3.3 方法</b><br>AddHistoryImage——添加一幅或者一组历史图像<br>TrainBackgroundModel——训练背景模型；如果传入了历史图像，则先添加历史图像，然后再训练背景模型<br>Update——更新背景模型，同时检测前景<br>ClearStale——清除消极的聚集中心<br>Dispose——释放资源</p>
<p><b>4 体会</b><br>&nbsp;&nbsp;&nbsp; NBGModel的确非常有效，非常简洁，特别适用于伴随复杂运动对象的背景建模。我特意选取了PETS2009中的素材对其做了一些测试，结果也证明了NBGModel的优越性。不过需要指出的是，它需要占用大量的内存（主要因为需要保存n幅历史图像）；它的计算量比较大。<br>在使用的过程中，它始终需要在内存中缓存n幅历史图像，1幅最可靠背景模型图像，1幅背景掩码图像，近似m幅图像（聚集中心）；而在训练阶段，更需要临时存储m幅收敛图像。<br>例如：样本数目为100，典型点数目为10，图像尺寸为768x576时，所用的内存接近300M，训练背景需要大约需要33秒，而对每幅图像进行前景检测大约需要600ms。虽然可以使用并行编程来提高性能，但是并不能从根本上解决问题。<br>（注：测试电脑的CPU为AMD闪龙3200+，内存1.5G。）<br>&nbsp;&nbsp;&nbsp; 看来，有必要研究一种新的方法，目标是检测效果更好，内存占用低，处理更快速。目前的想法是使用《Wallflower: Principles and Practice of Background Manitenance》中的3层架构（时间轴上的像素级处理，像素间的区域处理，帧间处理），但是对每层架构都选用目前流行的处理方式，并对处理方式进行优化。时间轴上的像素级处理打算使用CodeBook方法，但是增加本文的一些思想。像素间的区域处理打算参考《基于区域相关的核函数背景建模算法》中的方法。帧间处理预计会采用全局灰度统计值作为依据。</p>
<p>最后，按照惯例：<b>感谢您耐心看完本文，希望对您有所帮助。</b><br>本文所述方法及代码仅用于学习研究，不得用于商业目的。</p></div><div id="MySignature"></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory">分类: <a href="http://www.cnblogs.com/xrwang/category/231541.html" target="_blank">图像处理</a></div>
<div id="EntryTag"></div>
<div id="blog_post_info"><div id="green_channel">
        <a href="javascript:void(0);" id="green_channel_digg" onclick="DiggIt(1710038,cb_blogId,1);green_channel_success(this,&#39;谢谢推荐！&#39;);">好文要顶</a>
            <a id="green_channel_follow" onclick="follow(&#39;716e3d0b-63cf-dd11-9e4d-001cf0cd104b&#39;);" href="javascript:void(0);">关注我</a>
    <a id="green_channel_favorite" onclick="AddToWz(cb_entryId);return false;" href="javascript:void(0);">收藏该文</a>
    <a id="green_channel_weibo" href="javascript:void(0);" title="分享至新浪微博" onclick="ShareToTsina()"><img src="./背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园_files/icon_weibo_24.png" alt=""></a>
    <a id="green_channel_wechat" href="javascript:void(0);" title="分享至微信" onclick="shareOnWechat()"><img src="./背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园_files/wechat.png" alt=""></a>
</div>
<div id="author_profile">
    <div id="author_profile_info" class="author_profile_info">
            <a href="http://home.cnblogs.com/u/xrwang/" target="_blank"><img src="./背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园_files/u21602.jpg" class="author_avatar" alt=""></a>
        <div id="author_profile_detail" class="author_profile_info">
            <a href="http://home.cnblogs.com/u/xrwang/">Wuya</a><br>
            <a href="http://home.cnblogs.com/u/xrwang/followees">关注 - 5</a><br>
            <a href="http://home.cnblogs.com/u/xrwang/followers">粉丝 - 452</a>
        </div>
    </div>
    <div class="clear"></div>
    <div id="author_profile_honor"></div>
    <div id="author_profile_follow">
                <a href="javascript:void(0);" onclick="follow(&#39;716e3d0b-63cf-dd11-9e4d-001cf0cd104b&#39;);return false;">+加关注</a>
    </div>
</div>
<div id="div_digg">
    <div class="diggit" onclick="votePost(1710038,&#39;Digg&#39;)">
        <span class="diggnum" id="digg_count">5</span>
    </div>
    <div class="buryit" onclick="votePost(1710038,&#39;Bury&#39;)">
        <span class="burynum" id="bury_count">0</span>
    </div>
    <div class="clear"></div>
    <div class="diggword" id="digg_tips">
    </div>
</div>
</div>
<div class="clear"></div>
<div id="post_next_prev"><a href="http://www.cnblogs.com/xrwang/archive/2010/03/27/BackgroundGenerationAndForegroundDetectionPhase2.html" class="p_n_p_prefix">« </a> 上一篇：<a href="http://www.cnblogs.com/xrwang/archive/2010/03/27/BackgroundGenerationAndForegroundDetectionPhase2.html" title="发布于2010-03-27 15:29">背景建模与前景检测之二(Background Generation And Foreground Detection Phase 2)</a><br><a href="http://www.cnblogs.com/xrwang/archive/2010/04/27/GrabCut.html" class="p_n_p_prefix">» </a> 下一篇：<a href="http://www.cnblogs.com/xrwang/archive/2010/04/27/GrabCut.html" title="发布于2010-04-27 15:00">OpenCV(EmguCV)2.1新特性介绍之图像分割GrabCut(GrabCut Of OpenCV 2.1)</a><br></div>
</div>


		</div>
		<div class="postDesc">posted @ <span id="post-date">2010-04-12 11:08</span> <a href="http://www.cnblogs.com/xrwang/">Wuya</a> 阅读(<span id="post_view_count">8641</span>) 评论(<span id="post_comment_count">44</span>)  <a href="https://i.cnblogs.com/EditPosts.aspx?postid=1710038" rel="nofollow">编辑</a> <a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#" onclick="AddToWz(1710038);return false;">收藏</a></div>
	</div>
	<script type="text/javascript">var allowComments=true,cb_blogId=25161,cb_entryId=1710038,cb_blogApp=currentBlogApp,cb_blogUserGuid='716e3d0b-63cf-dd11-9e4d-001cf0cd104b',cb_entryCreatedDate='2010/4/12 11:08:00';loadViewCount(cb_entryId);</script>
	
</div><!--end: topics 文章、评论容器-->
</div><a name="!comments"></a><div id="blog-comments-placeholder"><div id="comments_pager_top"></div>
<!--done-->
<div class="feedback_area_title">评论列表</div>
<div class="feedbackNoItems"></div>
	

		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1799258" class="layer">#1楼</a><a name="1799258" id="comment_anchor_1799258"></a>  <span class="comment_date">2010-04-12 12:32</span> <a id="a_comment_author_1799258" href="http://www.cnblogs.com/justinw/" target="_blank">Justin</a> <a href="http://msg.cnblogs.com/send/Justin" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1799258" class="blog_comment_body">认真看完感觉楼主很用心<br>对这方面没什么研究，暂时没啥好意见 ：）</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1799258,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1799258,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_1799258_avatar" style="display:none;">http://pic.cnblogs.com/face/u7781.jpg</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1799268" class="layer">#2楼</a><a name="1799268" id="comment_anchor_1799268"></a>[<span class="louzhu">楼主</span>]  <span class="comment_date">2010-04-12 12:39</span> <a id="a_comment_author_1799268" href="http://www.cnblogs.com/xrwang/" target="_blank">Wuya</a> <a href="http://msg.cnblogs.com/send/Wuya" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1799268" class="blog_comment_body"><a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1799258" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,1799258);">@</a>
Justin<br>thanks.</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1799268,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1799268,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_1799268_avatar" style="display:none;">http://pic.cnblogs.com/face/u21602.jpg</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1800611" class="layer">#3楼</a><a name="1800611" id="comment_anchor_1800611"></a>  <span class="comment_date">2010-04-13 16:01</span> <a id="a_comment_author_1800611" href="http://home.cnblogs.com/u/126363/" target="_blank">frin</a> <a href="http://msg.cnblogs.com/send/frin" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1800611" class="blog_comment_body">你好，我想问一下NBGModel用OpenCV实现容易么？不太懂EmguCv.现在正在背景建模和前景检测入门中，你的文章很有帮助。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1800611,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1800611,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1801361" class="layer">#4楼</a><a name="1801361" id="comment_anchor_1801361"></a>[<span class="louzhu">楼主</span>]  <span class="comment_date">2010-04-14 11:45</span> <a id="a_comment_author_1801361" href="http://www.cnblogs.com/xrwang/" target="_blank">Wuya</a> <a href="http://msg.cnblogs.com/send/Wuya" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1801361" class="blog_comment_body">@frin<br>如果用OpenCV实现的话，也很容易的；<br>需要做以下转换就可以了：<br>Image&lt;TColor,TDepth&gt;  ---    IplImage<br>List&lt;T&gt;               ---    数组或者指针<br><br>期待你用C语言实现它，毕竟C语言比C#要快些。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1801361,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1801361,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_1801361_avatar" style="display:none;">http://pic.cnblogs.com/face/u21602.jpg</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1807651" class="layer">#5楼</a><a name="1807651" id="comment_anchor_1807651"></a>  <span class="comment_date">2010-04-22 14:43</span> <a id="a_comment_author_1807651" href="http://home.cnblogs.com/u/126363/" target="_blank">frin</a> <a href="http://msg.cnblogs.com/send/frin" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1807651" class="blog_comment_body">private List&lt;ClusterCenter&lt;Ycc&gt;&gt;[,] clusterCenters = null;我想问一下这个的作用具体是怎么用的？</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1807651,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1807651,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1807732" class="layer">#6楼</a><a name="1807732" id="comment_anchor_1807732"></a>[<span class="louzhu">楼主</span>]  <span class="comment_date">2010-04-22 16:15</span> <a id="a_comment_author_1807732" href="http://www.cnblogs.com/xrwang/" target="_blank">Wuya</a> <a href="http://msg.cnblogs.com/send/Wuya" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1807732" class="blog_comment_body"><fieldset class="comment_quote"><legend><a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1807651" title="查看引用原文">引用</a></legend>frin：private List&lt;ClusterCenter&lt;Ycc&gt;&gt;[,] clusterCenters = null;我想问一下这个的作用具体是怎么用的？</fieldset><br>首先，clusterCenters是一个二维数组，二维代表图像中的每个像素的行和列坐标；<br>其次，该数组的每个元素是一个列表，代表每个像素可能的聚集中心列表。因为每个像素可能有多个聚集中心，且数目不定，因此用列表比较方便。<br><br>值得注意的是：访问二维数组及列表的性能不如一维数组及链表，不过便于理解，方便使用而已。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1807732,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1807732,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_1807732_avatar" style="display:none;">http://pic.cnblogs.com/face/u21602.jpg</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1809067" class="layer">#7楼</a><a name="1809067" id="comment_anchor_1809067"></a>  <span class="comment_date">2010-04-23 23:27</span> <a id="a_comment_author_1809067" href="http://home.cnblogs.com/u/126363/" target="_blank">frin</a> <a href="http://msg.cnblogs.com/send/frin" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1809067" class="blog_comment_body">谢谢！~</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1809067,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1809067,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1832075" class="layer">#8楼</a><a name="1832075" id="comment_anchor_1832075"></a>  <span class="comment_date">2010-05-24 20:47</span> <a id="a_comment_author_1832075" href="http://home.cnblogs.com/u/134596/" target="_blank">zpsy</a> <a href="http://msg.cnblogs.com/send/zpsy" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1832075" class="blog_comment_body">您好！请问您的实验视频是从哪个数据库下的吗？能给个地址吗？非常感谢！</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1832075,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1832075,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1832360" class="layer">#9楼</a><a name="1832360" id="comment_anchor_1832360"></a>[<span class="louzhu">楼主</span>]  <span class="comment_date">2010-05-25 09:58</span> <a id="a_comment_author_1832360" href="http://www.cnblogs.com/xrwang/" target="_blank">Wuya</a> <a href="http://msg.cnblogs.com/send/Wuya" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1832360" class="blog_comment_body"><a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1832075" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,1832075);">@</a>
zpsy<br>我用的PETS2009数据库，PETS数据库每年都在开会前出新的，可以免费用于研究和学习领域。<br>PETS2009的介绍及下载地址是：<br><a href="http://www.cvg.rdg.ac.uk/PETS2009/a.html" target="_blank">http://www.cvg.rdg.ac.uk/PETS2009/a.html</a></div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1832360,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1832360,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_1832360_avatar" style="display:none;">http://pic.cnblogs.com/face/u21602.jpg</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1838087" class="layer">#10楼</a><a name="1838087" id="comment_anchor_1838087"></a>  <span class="comment_date">2010-06-01 20:37</span> <a id="a_comment_author_1838087" href="http://home.cnblogs.com/u/134596/" target="_blank">zpsy</a> <a href="http://msg.cnblogs.com/send/zpsy" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1838087" class="blog_comment_body"><a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1832360" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,1832360);">@</a>
Wuya<br>谢谢！</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1838087,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1838087,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1901826" class="layer">#11楼</a><a name="1901826" id="comment_anchor_1901826"></a>  <span class="comment_date">2010-08-25 22:13</span> <a id="a_comment_author_1901826" href="http://www.cnblogs.com/awaitc/" target="_blank">Edwin Xie</a> <a href="http://msg.cnblogs.com/send/Edwin%20Xie" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1901826" class="blog_comment_body">膜拜~~<br>最近做安保方面的一个系统，其中一项需求为人流密度检测<br>这一个月从0开始学图像处理，走了不少弯路才找到人流密度这块理论，深入学习下去发现自适应背景这块最为关键，在看到您这几篇文章之前一直苦于自适应背景这块问题。。看了您的文章受益很大~~</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1901826,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1901826,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_1901826_avatar" style="display:none;">http://pic.cnblogs.com/face/u27597.jpg</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1901855" class="layer">#12楼</a><a name="1901855" id="comment_anchor_1901855"></a>[<span class="louzhu">楼主</span>]  <span class="comment_date">2010-08-25 22:59</span> <a id="a_comment_author_1901855" href="http://www.cnblogs.com/xrwang/" target="_blank">Wuya</a> <a href="http://msg.cnblogs.com/send/Wuya" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1901855" class="blog_comment_body"><a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1901826" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,1901826);">@</a>
Edwin Xie<br>哈哈，加油。<br>其实这个系列还有之四的，不过文章相关论文尚未正式刊出，因此依照导师的意见暂时没发表。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1901855,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1901855,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_1901855_avatar" style="display:none;">http://pic.cnblogs.com/face/u21602.jpg</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1926205" class="layer">#13楼</a><a name="1926205" id="comment_anchor_1926205"></a>  <span class="comment_date">2010-09-28 15:29</span> <a id="a_comment_author_1926205" href="http://www.cnblogs.com/wly603/" target="_blank">wly603</a> <a href="http://msg.cnblogs.com/send/wly603" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1926205" class="blog_comment_body"><a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1800611" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,1800611);">@</a>
frin<br>  你好！请问您用C语言实现了吗？我刚看了这篇文章，想利用open cv实现。想跟你请教下！</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1926205,&#39;Digg&#39;,this)">支持(1)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1926205,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_1926205_avatar" style="display:none;">http://pic.cnblogs.com/face/u156532.jpg</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1926209" class="layer">#14楼</a><a name="1926209" id="comment_anchor_1926209"></a>  <span class="comment_date">2010-09-28 15:31</span> <a id="a_comment_author_1926209" href="http://www.cnblogs.com/wly603/" target="_blank">wly603</a> <a href="http://msg.cnblogs.com/send/wly603" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1926209" class="blog_comment_body">期待您该系列之四！现在先好好学习下您的这篇算法实现文章。。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1926209,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1926209,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_1926209_avatar" style="display:none;">http://pic.cnblogs.com/face/u156532.jpg</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1926248" class="layer">#15楼</a><a name="1926248" id="comment_anchor_1926248"></a>[<span class="louzhu">楼主</span>]  <span class="comment_date">2010-09-28 16:01</span> <a id="a_comment_author_1926248" href="http://www.cnblogs.com/xrwang/" target="_blank">Wuya</a> <a href="http://msg.cnblogs.com/send/Wuya" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1926248" class="blog_comment_body"><a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1926209" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,1926209);">@</a>
wly603<br>这个系列的第四篇其实已经写好了，<br>可惜期刊的发文速度实在是慢，要等到明年年底才会刊出论文。<br>因此我也不好先发布到网上。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1926248,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1926248,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_1926248_avatar" style="display:none;">http://pic.cnblogs.com/face/u21602.jpg</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1943408" class="layer">#16楼</a><a name="1943408" id="comment_anchor_1943408"></a>  <span class="comment_date">2010-10-26 14:09</span> <a id="a_comment_author_1943408" href="http://www.cnblogs.com/hjqxaly/" target="_blank">echobs</a> <a href="http://msg.cnblogs.com/send/echobs" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1943408" class="blog_comment_body">谢谢楼主与大家分享您的劳动成果，我是做视频方向的，但看到这篇Paper内的算法不错，看了你的C#代码，有点头大，因为我不怎么懂这个，我想验证一下你这个代码的实现效果，能否把你的这篇文章所有的代码发给我，不胜感激<br>邮箱：hjqxaly@163.com</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1943408,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1943408,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1944073" class="layer">#17楼</a><a name="1944073" id="comment_anchor_1944073"></a>[<span class="louzhu">楼主</span>]  <span class="comment_date">2010-10-27 09:04</span> <a id="a_comment_author_1944073" href="http://www.cnblogs.com/xrwang/" target="_blank">Wuya</a> <a href="http://msg.cnblogs.com/send/Wuya" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1944073" class="blog_comment_body"><a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1943408" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,1943408);">@</a>
echobs<br>文章中已经有全部代码了。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1944073,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1944073,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_1944073_avatar" style="display:none;">http://pic.cnblogs.com/face/u21602.jpg</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1945234" class="layer">#18楼</a><a name="1945234" id="comment_anchor_1945234"></a>  <span class="comment_date">2010-10-28 14:26</span> <a id="a_comment_author_1945234" href="http://www.cnblogs.com/hjqxaly/" target="_blank">echobs</a> <a href="http://msg.cnblogs.com/send/echobs" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1945234" class="blog_comment_body">楼主用的哪个版本，我下载的Emgu.CV.SourceAndExamples-1.3.0.0.zip  <br>Emgu.CV.Windows.Binary-1.3.0.0.zip   怎么没有找到using Emgu.CV.Structure;的引用，导致程序出错</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1945234,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1945234,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1945240" class="layer">#19楼</a><a name="1945240" id="comment_anchor_1945240"></a>[<span class="louzhu">楼主</span>]  <span class="comment_date">2010-10-28 14:30</span> <a id="a_comment_author_1945240" href="http://www.cnblogs.com/xrwang/" target="_blank">Wuya</a> <a href="http://msg.cnblogs.com/send/Wuya" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1945240" class="blog_comment_body"><a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1945234" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,1945234);">@</a>
echobs<br>刚开始的时候用的是2.0的版本，后来用EmguCv 2.1版本了。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1945240,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1945240,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_1945240_avatar" style="display:none;">http://pic.cnblogs.com/face/u21602.jpg</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1946280" class="layer">#20楼</a><a name="1946280" id="comment_anchor_1946280"></a>  <span class="comment_date">2010-10-29 15:38</span> <a id="a_comment_author_1946280" href="http://www.cnblogs.com/hjqxaly/" target="_blank">echobs</a> <a href="http://msg.cnblogs.com/send/echobs" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1946280" class="blog_comment_body">谢谢你的程序，我运行了一下，int widthStepHistoryImage = historyImages[0].MIplImage.widthStep;           //历史图像的每行字节数                         当单击前景检测的时候出现异常：“索引超出范围，必须为非负值并小与集合大小”，改怎么解决</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1946280,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1946280,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1948254" class="layer">#21楼</a><a name="1948254" id="comment_anchor_1948254"></a>  <span class="comment_date">2010-11-01 13:55</span> <a id="a_comment_author_1948254" href="http://www.cnblogs.com/hjqxaly/" target="_blank">echobs</a> <a href="http://msg.cnblogs.com/send/echobs" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1948254" class="blog_comment_body">问题已经解决，谢谢<br>我的图片测试的时候，背景总是蓝色，前景检测的时候没有前景出现，我考虑是图片的问题，楼主能否把图片发给我几张做测试用，谢谢</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1948254,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1948254,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1948258" class="layer">#22楼</a><a name="1948258" id="comment_anchor_1948258"></a>[<span class="louzhu">楼主</span>]  <span class="comment_date">2010-11-01 13:59</span> <a id="a_comment_author_1948258" href="http://www.cnblogs.com/xrwang/" target="_blank">Wuya</a> <a href="http://msg.cnblogs.com/send/Wuya" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1948258" class="blog_comment_body"><a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1946280" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,1946280);">@</a>
echobs<br>这里的“索引超出范围”，我估计是因为historyImages为null，或者元素个数为0所致。<br>您可以在VS中设置断点调试看看。<br><br>至于测试图片我用的是PETS2009的图片，您可以用google搜索，现在也许有PETS2010了。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1948258,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1948258,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_1948258_avatar" style="display:none;">http://pic.cnblogs.com/face/u21602.jpg</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1949277" class="layer">#23楼</a><a name="1949277" id="comment_anchor_1949277"></a>  <span class="comment_date">2010-11-02 13:43</span> <a id="a_comment_author_1949277" href="http://www.cnblogs.com/hjqxaly/" target="_blank">echobs</a> <a href="http://msg.cnblogs.com/send/echobs" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1949277" class="blog_comment_body">调出来了，是因为容量最大是100，属性设置问题，呵呵，谢谢你哦</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1949277,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1949277,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1950467" class="layer">#24楼</a><a name="1950467" id="comment_anchor_1950467"></a>  <span class="comment_date">2010-11-03 15:06</span> <a id="a_comment_author_1950467" href="http://www.cnblogs.com/hjqxaly/" target="_blank">echobs</a> <a href="http://msg.cnblogs.com/send/echobs" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1950467" class="blog_comment_body">背景训练没问题，可前景检测的时候总是出现的绿色图案，没有前景出现，不知道是什么原因，望楼主答复。谢谢</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1950467,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1950467,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1950573" class="layer">#25楼</a><a name="1950573" id="comment_anchor_1950573"></a>  <span class="comment_date">2010-11-03 16:33</span> <a id="a_comment_author_1950573" href="http://www.cnblogs.com/hjqxaly/" target="_blank">echobs</a> <a href="http://msg.cnblogs.com/send/echobs" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1950573" class="blog_comment_body">问题解决，谢谢楼主，是我的视频库有问题</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1950573,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1950573,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1950655" class="layer">#26楼</a><a name="1950655" id="comment_anchor_1950655"></a>  <span class="comment_date">2010-11-03 17:49</span> <a id="a_comment_author_1950655" href="http://www.cnblogs.com/hjqxaly/" target="_blank">echobs</a> <a href="http://msg.cnblogs.com/send/echobs" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1950655" class="blog_comment_body">还是不行，前景检测就检测不出来，不知道是什么原因</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1950655,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1950655,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1955927" class="layer">#27楼</a><a name="1955927" id="comment_anchor_1955927"></a>  <span class="comment_date">2010-11-08 20:40</span> <a id="a_comment_author_1955927" href="http://www.cnblogs.com/hjqxaly/" target="_blank">echobs</a> <a href="http://msg.cnblogs.com/send/echobs" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1955927" class="blog_comment_body">前景检测不出来，麻烦楼主是什么原因啊</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1955927,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1955927,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1956885" class="layer">#28楼</a><a name="1956885" id="comment_anchor_1956885"></a>[<span class="louzhu">楼主</span>]  <span class="comment_date">2010-11-09 21:07</span> <a id="a_comment_author_1956885" href="http://www.cnblogs.com/xrwang/" target="_blank">Wuya</a> <a href="http://msg.cnblogs.com/send/Wuya" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1956885" class="blog_comment_body"><a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1955927" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,1955927);">@</a>
echobs<br>出不来吗？<br>您把图片发给我，等我有空了试试看。<br>或者您可以拿PETS2009数据库中的图片做测试。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1956885,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1956885,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_1956885_avatar" style="display:none;">http://pic.cnblogs.com/face/u21602.jpg</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1957097" class="layer">#29楼</a><a name="1957097" id="comment_anchor_1957097"></a>  <span class="comment_date">2010-11-10 09:01</span> <a id="a_comment_author_1957097" href="http://www.cnblogs.com/hjqxaly/" target="_blank">echobs</a> <a href="http://msg.cnblogs.com/send/echobs" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1957097" class="blog_comment_body"> 我不会发图片啊，你能把你的邮箱告诉我吗，我给你发邮件</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1957097,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1957097,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1957523" class="layer">#30楼</a><a name="1957523" id="comment_anchor_1957523"></a>[<span class="louzhu">楼主</span>]  <span class="comment_date">2010-11-10 15:06</span> <a id="a_comment_author_1957523" href="http://www.cnblogs.com/xrwang/" target="_blank">Wuya</a> <a href="http://msg.cnblogs.com/send/Wuya" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_1957523" class="blog_comment_body"><a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#1957097" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,1957097);">@</a>
echobs<br>好啊好啊，邮箱地址是：xrwang#126.com<br>请自行将#替换成@。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(1957523,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(1957523,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_1957523_avatar" style="display:none;">http://pic.cnblogs.com/face/u21602.jpg</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#2041032" class="layer">#31楼</a><a name="2041032" id="comment_anchor_2041032"></a>  <span class="comment_date">2011-03-08 10:53</span> <a id="a_comment_author_2041032" href="http://home.cnblogs.com/u/280039/" target="_blank">liu_gao</a> <a href="http://msg.cnblogs.com/send/liu_gao" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2041032" class="blog_comment_body">非常感谢楼主与大家分享劳动成果，正为实现这篇文章的算法发愁呢！谢谢了!<br></div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2041032,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2041032,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#2041651" class="layer">#32楼</a><a name="2041651" id="comment_anchor_2041651"></a>[<span class="louzhu">楼主</span>]  <span class="comment_date">2011-03-08 17:49</span> <a id="a_comment_author_2041651" href="http://www.cnblogs.com/xrwang/" target="_blank">Wuya</a> <a href="http://msg.cnblogs.com/send/Wuya" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2041651" class="blog_comment_body"><a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#2041032" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,2041032);">@</a>
liu_gao<br>不用客气，哈哈。我写得不好，执行效率不高。<br>您可以将其改写成C语言的版本，效率应该会好些。<br>如果您有时间，请帮忙到我老婆的网店去花0.1元买个东西帮我增加一个交易量，多谢。<br>地址是：<a href="http://item.taobao.com/auction/itemDetail.htm?item_num_id" target="_blank">http://item.taobao.com/auction/itemDetail.htm?item_num_id</a>=9495154832</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2041651,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2041651,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_2041651_avatar" style="display:none;">http://pic.cnblogs.com/face/u21602.jpg</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#2153268" class="layer">#33楼</a><a name="2153268" id="comment_anchor_2153268"></a>  <span class="comment_date">2011-07-17 10:45</span> <a id="a_comment_author_2153268" href="http://home.cnblogs.com/u/316065/" target="_blank">远方游子</a> <a href="http://msg.cnblogs.com/send/%E8%BF%9C%E6%96%B9%E6%B8%B8%E5%AD%90" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2153268" class="blog_comment_body">请问，您系列之四的题目是什么？谢谢</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2153268,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2153268,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#2153682" class="layer">#34楼</a><a name="2153682" id="comment_anchor_2153682"></a>[<span class="louzhu">楼主</span>]  <span class="comment_date">2011-07-18 08:15</span> <a id="a_comment_author_2153682" href="http://www.cnblogs.com/xrwang/" target="_blank">Wuya</a> <a href="http://msg.cnblogs.com/send/Wuya" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2153682" class="blog_comment_body"><a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#2153268" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,2153268);">@</a>
远方游子<br>名字和内容都有了：<br>背景建模与前景检测之四：多阶编码本背景模型(Background Generation And Foreground Detection Phase 4：MPCB Model)<br>由于文章迟迟未被刊登，因此把已经发表过很小段时间的博文删除掉了。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2153682,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2153682,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_2153682_avatar" style="display:none;">http://pic.cnblogs.com/face/u21602.jpg</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#2321724" class="layer">#35楼</a><a name="2321724" id="comment_anchor_2321724"></a>  <span class="comment_date">2012-03-03 01:54</span> <a id="a_comment_author_2321724" href="http://home.cnblogs.com/u/348878/" target="_blank">都梁wu</a> <a href="http://msg.cnblogs.com/send/%E9%83%BD%E6%A2%81wu" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2321724" class="blog_comment_body">博主，我不了解emgucv，但是我想弱弱问一句，opencv2.3版本有没有哪个程序实现Nonparametric Background Generation这篇论文中的算法</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2321724,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2321724,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#2321788" class="layer">#36楼</a><a name="2321788" id="comment_anchor_2321788"></a>[<span class="louzhu">楼主</span>]  <span class="comment_date">2012-03-03 10:12</span> <a id="a_comment_author_2321788" href="http://www.cnblogs.com/xrwang/" target="_blank">Wuya</a> <a href="http://msg.cnblogs.com/send/Wuya" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2321788" class="blog_comment_body"><a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#2321724" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,2321724);">@</a>
都梁wu<br>我没去看OpenCV2.3不知道呢。<br>您自己去看看更新说明呗。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2321788,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2321788,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_2321788_avatar" style="display:none;">http://pic.cnblogs.com/face/u21602.jpg</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#2322377" class="layer">#37楼</a><a name="2322377" id="comment_anchor_2322377"></a>  <span class="comment_date">2012-03-04 12:56</span> <a id="a_comment_author_2322377" href="http://home.cnblogs.com/u/348878/" target="_blank">都梁wu</a> <a href="http://msg.cnblogs.com/send/%E9%83%BD%E6%A2%81wu" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2322377" class="blog_comment_body"><a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#2321788" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,2321788);">@</a>
Wuya<br>谢谢博主啦！我看了一下，好像没有！提供了两种混合高斯模型，码本，FGD模型！博主那个NBG是自己写的吧！</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2322377,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2322377,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#2322707" class="layer">#38楼</a><a name="2322707" id="comment_anchor_2322707"></a>[<span class="louzhu">楼主</span>]  <span class="comment_date">2012-03-04 23:39</span> <a id="a_comment_author_2322707" href="http://www.cnblogs.com/xrwang/" target="_blank">Wuya</a> <a href="http://msg.cnblogs.com/send/Wuya" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2322707" class="blog_comment_body"><a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#2322377" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,2322377);">@</a>
都梁wu<br>是的，写得不好，效率有点低。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2322707,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2322707,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_2322707_avatar" style="display:none;">http://pic.cnblogs.com/face/u21602.jpg</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#2389651" class="layer">#39楼</a><a name="2389651" id="comment_anchor_2389651"></a>  <span class="comment_date">2012-05-31 00:49</span> <a id="a_comment_author_2389651" href="http://home.cnblogs.com/u/408543/" target="_blank">fandsh</a> <a href="http://msg.cnblogs.com/send/fandsh" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2389651" class="blog_comment_body">博主，您好！在运行您的前景检测与背景建模2 的程序时候显示<br>“未处理的“System.IO.FileNotFoundException”类型的异常出现在 System.Drawing.dll 中。”请问是什么问题呢，另外，您的程序可以测试已有的视频文件吗？ 在下刚学这方面知识不太清楚，谢谢您啦！</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2389651,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2389651,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#2389694" class="layer">#40楼</a><a name="2389694" id="comment_anchor_2389694"></a>[<span class="louzhu">楼主</span>]  <span class="comment_date">2012-05-31 07:55</span> <a id="a_comment_author_2389694" href="http://www.cnblogs.com/xrwang/" target="_blank">Wuya</a> <a href="http://msg.cnblogs.com/send/Wuya" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2389694" class="blog_comment_body"><a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#2389651" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,2389651);">@</a>
fandsh<br>（1）出现这个异常说明程序没有找到所需的文件，例如图片文件。<br>（2）您稍加改动，从视频中先获取每一帧图片，然后就一样的处理了。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2389694,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2389694,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_2389694_avatar" style="display:none;">http://pic.cnblogs.com/face/u21602.jpg</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#2390105" class="layer">#41楼</a><a name="2390105" id="comment_anchor_2390105"></a>  <span class="comment_date">2012-05-31 12:34</span> <a id="a_comment_author_2390105" href="http://home.cnblogs.com/u/408543/" target="_blank">fandsh</a> <a href="http://msg.cnblogs.com/send/fandsh" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2390105" class="blog_comment_body"><a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#2389694" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,2389694);">@</a>
Wuya<br>好的，谢谢博主！</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2390105,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2390105,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#2608448" class="layer">#42楼</a><a name="2608448" id="comment_anchor_2608448"></a>  <span class="comment_date">2013-01-26 21:55</span> <a id="a_comment_author_2608448" href="http://www.cnblogs.com/opencv/" target="_blank">fxl1100</a> <a href="http://msg.cnblogs.com/send/fxl1100" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2608448" class="blog_comment_body">楼主好厉害，拜读中！</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2608448,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2608448,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#2724487" class="layer">#43楼</a><a name="2724487" id="comment_anchor_2724487"></a>  <span class="comment_date">2013-07-10 22:13</span> <a id="a_comment_author_2724487" href="http://home.cnblogs.com/u/546810/" target="_blank">asiya</a> <a href="http://msg.cnblogs.com/send/asiya" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_2724487" class="blog_comment_body">博主太牛了，学习中，希望哪天也能向博主一样，能够看完论文后还能编出代码，佩服</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(2724487,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(2724487,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#3056195" class="layer">#44楼</a><a name="3056195" id="comment_anchor_3056195"></a><span id="comment-maxId" style="display:none;">3056195</span><span id="comment-maxDate" style="display:none;">2014/11/3 10:50:44</span>  <span class="comment_date">2014-11-03 10:50</span> <a id="a_comment_author_3056195" href="http://home.cnblogs.com/u/687717/" target="_blank">SPDreamer</a> <a href="http://msg.cnblogs.com/send/SPDreamer" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3056195" class="blog_comment_body">博主好厉害，我才研究这个</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3056195,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3056195,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	<div id="comments_pager_bottom"></div></div><script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script>
<div id="comment_form" class="commentform">
<a name="commentform"></a>
<div id="divCommentShow"></div>
<div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#" onclick="return RefreshPage();">刷新页面</a><a href="http://www.cnblogs.com/xrwang/archive/2010/04/12/BackgroundGenerationAndForegroundDetectionPhase3.html#top">返回顶部</a></div>
<div id="comment_form_container"><div class="login_tips">注册用户登录后才能发表评论，请 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return login(&#39;commentform&#39;);">登录</a> 或 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return register();">注册</a>，<a href="http://www.cnblogs.com/">访问</a>网站首页。</div></div>
<div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
<div id="ad_t2"><a href="http://www.ucancode.com/index.htm" target="_blank">【推荐】50万行VC++源码: 大型组态工控、电力仿真CAD与GIS源码库</a><br><a href="http://cn.udacity.com/fend/?utm_source=cnblogs&utm_medium=referral&utm_campaign=newFEND" target="_blank">【推荐】Google+GitHub联手打造前端工程师课程</a><br></div>
<div id="opt_under_post"></div>
<div id="ad_c1" class="c_ad_block">     <ins class="adsbygoogle" style="display: inline-block; width: 300px; height: 250px;" data-ad-client="ca-pub-4210569241504288" data-ad-slot="5457903683" data-adsbygoogle-status="done"><ins id="aswift_0_expand" style="display:inline-table;border:none;height:250px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><ins id="aswift_0_anchor" style="display:block;border:none;height:250px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><iframe width="300" height="250" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;"></iframe></ins></ins></ins></div>
<div id="under_post_news"><div class="itnews c_ad_block"><b>最新IT新闻</b>:<br> ·  <a href="http://news.cnblogs.com/n/564523/" target="_blank">蘑菇租房联合蚂蚁金服 看新金融如何改变房屋租赁市场</a><br> ·  <a href="http://news.cnblogs.com/n/564521/" target="_blank">Facebook正式推出360度全景视频服务</a><br> ·  <a href="http://news.cnblogs.com/n/564520/" target="_blank">苹果或沿袭黄金版手表 将十年版手机定名“iPhone Edition”</a><br> ·  <a href="http://news.cnblogs.com/n/564519/" target="_blank">年产能3000万台？共享单车资本竞赛正在颠覆传统自行车生意</a><br> ·  <a href="http://news.cnblogs.com/n/564518/" target="_blank">乐视第三大股东：没孙宏斌我们就死了 汽车还有三道坎要过</a><br>» <a href="http://news.cnblogs.com/" title="IT新闻" target="_blank">更多新闻...</a></div></div>
<div id="ad_c2" class="c_ad_block"><a href="http://bbs.h3bpm.com/index.php?m=app&app=product_download&a=reg&utm_source=csdn&utm_medium=pic&utm_campaign=show&utm_content=v10&utm_term=%E5%85%8D%E8%B4%B9%E4%B8%8B%E8%BD%BD" target="_blank"><img width="468" height="60" src="./背景建模与前景检测之三(Background Generation And Foreground Detection Phase 3) - Wuya - 博客园_files/24442-20170118152220281-363324784.jpg" alt=""></a></div>
<div id="under_post_kb"><div class="itnews c_ad_block" id="kb_block"><b>最新知识库文章</b>:<br><div id="kb_recent"> ·  <a href="http://kb.cnblogs.com/page/562433/" target="_blank">垃圾回收原来是这么回事</a><br> ·  <a href="http://kb.cnblogs.com/page/554260/" target="_blank">「代码家」的学习过程和学习经验分享</a><br> ·  <a href="http://kb.cnblogs.com/page/556770/" target="_blank">写给未来的程序媛</a><br> ·  <a href="http://kb.cnblogs.com/page/558087/" target="_blank">高质量的工程代码为什么难写</a><br> ·  <a href="http://kb.cnblogs.com/page/555750/" target="_blank">循序渐进地代码重构</a><br></div>» <a href="http://kb.cnblogs.com/" target="_blank">更多知识库文章...</a></div></div>
<div id="HistoryToday" class="c_ad_block"></div>
<script type="text/javascript">
    fixPostBody();
    setTimeout(function () { incrementViewCount(cb_entryId); }, 50);
    deliverAdT2();
    deliverAdC1();
    deliverAdC2();    
    loadNewsAndKb();
    loadBlogSignature();
    LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
    GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate);
    loadOptUnderPost();
    GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);   
</script>
</div>


	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
<!--done-->
<div class="newsItem">
<h3 class="catListTitle">公告</h3>
	<div id="blog-news"><div id="profile_block">昵称：<a href="http://home.cnblogs.com/u/xrwang/">Wuya</a><br>园龄：<a href="http://home.cnblogs.com/u/xrwang/" title="入园时间：2007-03-16">9年11个月</a><br>粉丝：<a href="http://home.cnblogs.com/u/xrwang/followers/">452</a><br>关注：<a href="http://home.cnblogs.com/u/xrwang/followees/">5</a><div id="p_b_follow"><a href="javascript:void(0);" onclick="follow(&#39;716e3d0b-63cf-dd11-9e4d-001cf0cd104b&#39;)">+加关注</a></div></div></div><script type="text/javascript">loadBlogNews();</script>
</div>

			<div id="calendar"><div id="blog-calendar" style=""><table id="blogCalendar" class="Cal" cellspacing="0" cellpadding="0" title="Calendar">
	<tbody><tr><td colspan="7"><table class="CalTitle" cellspacing="0">
		<tbody><tr><td class="CalNextPrev"><a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2010/03/01&#39;);return false;">&lt;</a></td><td align="center">2010年4月</td><td class="CalNextPrev" align="right"><a href="javascript:void(0);" onclick="loadBlogCalendar(&#39;2010/05/01&#39;);return false;">&gt;</a></td></tr>
	</tbody></table></td></tr><tr><th class="CalDayHeader" align="center" abbr="日" scope="col">日</th><th class="CalDayHeader" align="center" abbr="一" scope="col">一</th><th class="CalDayHeader" align="center" abbr="二" scope="col">二</th><th class="CalDayHeader" align="center" abbr="三" scope="col">三</th><th class="CalDayHeader" align="center" abbr="四" scope="col">四</th><th class="CalDayHeader" align="center" abbr="五" scope="col">五</th><th class="CalDayHeader" align="center" abbr="六" scope="col">六</th></tr><tr><td class="CalOtherMonthDay" align="center">28</td><td class="CalOtherMonthDay" align="center">29</td><td class="CalOtherMonthDay" align="center">30</td><td class="CalOtherMonthDay" align="center">31</td><td align="center">1</td><td align="center">2</td><td class="CalWeekendDay" align="center">3</td></tr><tr><td class="CalWeekendDay" align="center">4</td><td align="center">5</td><td align="center">6</td><td align="center">7</td><td align="center">8</td><td align="center">9</td><td class="CalWeekendDay" align="center">10</td></tr><tr><td class="CalWeekendDay" align="center">11</td><td align="center"><a href="http://www.cnblogs.com/xrwang/archive/2010/04/12.html"><u>12</u></a></td><td align="center">13</td><td align="center">14</td><td align="center">15</td><td align="center">16</td><td class="CalWeekendDay" align="center">17</td></tr><tr><td class="CalWeekendDay" align="center">18</td><td align="center">19</td><td align="center">20</td><td align="center">21</td><td align="center">22</td><td align="center">23</td><td class="CalWeekendDay" align="center">24</td></tr><tr><td class="CalWeekendDay" align="center">25</td><td align="center">26</td><td align="center"><a href="http://www.cnblogs.com/xrwang/archive/2010/04/27.html"><u>27</u></a></td><td align="center">28</td><td align="center"><a href="http://www.cnblogs.com/xrwang/archive/2010/04/29.html"><u>29</u></a></td><td align="center">30</td><td class="CalOtherMonthDay" align="center">1</td></tr><tr><td class="CalOtherMonthDay" align="center">2</td><td class="CalOtherMonthDay" align="center">3</td><td class="CalOtherMonthDay" align="center">4</td><td class="CalOtherMonthDay" align="center">5</td><td class="CalOtherMonthDay" align="center">6</td><td class="CalOtherMonthDay" align="center">7</td><td class="CalOtherMonthDay" align="center">8</td></tr>
</tbody></table></div><script type="text/javascript">loadBlogDefaultCalendar();</script></div>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"><div id="sidebar_search" class="sidebar-block">
<div id="sidebar_search" class="mySearch">
<h3 class="catListTitle">搜索</h3>
<div id="sidebar_search_box">
<div id="widget_my_zzk" class="div_my_zzk"><input type="text" id="q" onkeydown="return zzk_go_enter(event);" class="input_my_zzk">&nbsp;<input onclick="zzk_go()" type="button" value="找找看" id="btnZzk" class="btn_my_zzk"></div>

</div>
</div>

</div><div id="sidebar_shortcut" class="sidebar-block">
<div class="catListLink">
<h3 class="catListTitle">常用链接</h3>
<ul>
<li><a href="http://www.cnblogs.com/xrwang/p/" title="我的博客的随笔列表">我的随笔</a></li><li><a href="http://www.cnblogs.com/xrwang/MyComments.html" title="我发表过的评论列表">我的评论</a></li><li><a href="http://www.cnblogs.com/xrwang/OtherPosts.html" title="我评论过的随笔列表">我的参与</a></li><li><a href="http://www.cnblogs.com/xrwang/RecentComments.html" title="我的博客的评论列表">最新评论</a></li><li><a href="http://www.cnblogs.com/xrwang/tag/" title="我的博客的标签列表">我的标签</a></li>
</ul>
<div id="itemListLin_con" style="display:none;">
<ul>

</ul>
</div>
</div></div><div id="sidebar_toptags" class="sidebar-block">
<div class="catListTag">
<h3 class="catListTitle">我的标签</h3>
<ul>
<li><a href="http://www.cnblogs.com/xrwang/tag/weixin/">weixin</a>(5)</li><li><a href="http://www.cnblogs.com/xrwang/tag/javascript/">javascript</a>(2)</li><li><a href="http://www.cnblogs.com/xrwang/tag/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/">图像处理</a>(2)</li><li><a href="http://www.cnblogs.com/xrwang/tag/%E9%A2%9C%E8%89%B2/">颜色</a>(1)</li><li><a href="http://www.cnblogs.com/xrwang/tag/%E6%A0%B7%E5%BC%8F%E8%A1%A8/">样式表</a>(1)</li><li><a href="http://www.cnblogs.com/xrwang/tag/js/">js</a>(1)</li><li><a href="http://www.cnblogs.com/xrwang/tag/RANSAC%20%E9%9A%8F%E6%9C%BA%E6%8A%BD%E6%A0%B7%E4%B8%80%E8%87%B4%E6%80%A7%E7%AE%97%E6%B3%95/">RANSAC 随机抽样一致性算法</a>(1)</li><li><a href="http://www.cnblogs.com/xrwang/tag/vbs/">vbs</a>(1)</li><li><a href="http://www.cnblogs.com/xrwang/tag/vs2005/">vs2005</a>(1)</li><li><a href="http://www.cnblogs.com/xrwang/tag/.net%20%E5%9B%BE%E7%89%87%20%E6%AF%94%E8%BE%83/">.net 图片 比较</a>(1)</li><li><a href="http://www.cnblogs.com/xrwang/tag/">更多</a></li>
</ul>
</div></div><div id="sidebar_categories">
<div class="catListPostCategory">
<h3 class="catListTitle">随笔分类<span style="font-size:11px;font-weight:normal">(34)</span></h3>

<ul>

<li><a id="CatList_LinkList_0_Link_0" href="http://www.cnblogs.com/xrwang/category/286522.html">asp.net网站(2)</a> </li>

<li><a id="CatList_LinkList_0_Link_1" href="http://www.cnblogs.com/xrwang/category/575377.html">安卓开发(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_2" href="http://www.cnblogs.com/xrwang/category/303742.html">其他(4)</a> </li>

<li><a id="CatList_LinkList_0_Link_3" href="http://www.cnblogs.com/xrwang/category/286829.html">算法(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_4" href="http://www.cnblogs.com/xrwang/category/231541.html">图像处理(21)</a> </li>

<li><a id="CatList_LinkList_0_Link_5" href="http://www.cnblogs.com/xrwang/category/660918.html">微信(5)</a> </li>

</ul>

</div>

<div class="catListPostArchive">
<h3 class="catListTitle">随笔档案<span style="font-size:11px;font-weight:normal">(40)</span></h3>

<ul>

<li><a id="CatList_LinkList_1_Link_0" href="http://www.cnblogs.com/xrwang/archive/2015/03.html">2015年3月 (3)</a> </li>

<li><a id="CatList_LinkList_1_Link_1" href="http://www.cnblogs.com/xrwang/archive/2015/02.html">2015年2月 (2)</a> </li>

<li><a id="CatList_LinkList_1_Link_2" href="http://www.cnblogs.com/xrwang/archive/2014/05.html">2014年5月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_3" href="http://www.cnblogs.com/xrwang/archive/2014/02.html">2014年2月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_4" href="http://www.cnblogs.com/xrwang/archive/2013/05.html">2013年5月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_5" href="http://www.cnblogs.com/xrwang/archive/2012/06.html">2012年6月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_6" href="http://www.cnblogs.com/xrwang/archive/2012/04.html">2012年4月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_7" href="http://www.cnblogs.com/xrwang/archive/2011/07.html">2011年7月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_8" href="http://www.cnblogs.com/xrwang/archive/2011/06.html">2011年6月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_9" href="http://www.cnblogs.com/xrwang/archive/2011/04.html">2011年4月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_10" href="http://www.cnblogs.com/xrwang/archive/2011/03.html">2011年3月 (2)</a> </li>

<li><a id="CatList_LinkList_1_Link_11" href="http://www.cnblogs.com/xrwang/archive/2010/12.html">2010年12月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_12" href="http://www.cnblogs.com/xrwang/archive/2010/11.html">2010年11月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_13" href="http://www.cnblogs.com/xrwang/archive/2010/04.html">2010年4月 (3)</a> </li>

<li><a id="CatList_LinkList_1_Link_14" href="http://www.cnblogs.com/xrwang/archive/2010/03.html">2010年3月 (2)</a> </li>

<li><a id="CatList_LinkList_1_Link_15" href="http://www.cnblogs.com/xrwang/archive/2010/02.html">2010年2月 (7)</a> </li>

<li><a id="CatList_LinkList_1_Link_16" href="http://www.cnblogs.com/xrwang/archive/2010/01.html">2010年1月 (3)</a> </li>

<li><a id="CatList_LinkList_1_Link_17" href="http://www.cnblogs.com/xrwang/archive/2008/09.html">2008年9月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_18" href="http://www.cnblogs.com/xrwang/archive/2008/08.html">2008年8月 (3)</a> </li>

<li><a id="CatList_LinkList_1_Link_19" href="http://www.cnblogs.com/xrwang/archive/2008/07.html">2008年7月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_20" href="http://www.cnblogs.com/xrwang/archive/2008/01.html">2008年1月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_21" href="http://www.cnblogs.com/xrwang/archive/2007/05.html">2007年5月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_22" href="http://www.cnblogs.com/xrwang/archive/2007/03.html">2007年3月 (1)</a> </li>

</ul>

</div>

</div><div id="sidebar_recentcomments" class="sidebar-block"><div id="recent_comments_wrap">
<div class="catListComment">
<h3 class="catListTitle">最新评论</h3>
	<div id="RecentCommentsBlock"><ul>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/xrwang/archive/2010/02/21/ForegroundDetection.html#3624767">1. Re:背景建模与前景检测(Background Generation And Foreground Detection)</a></li>
        <li class="recent_comment_body">感谢楼主无私分享，非常谢谢，比爱心</li>
        <li class="recent_comment_author">--小福贵啦啦</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/xrwang/p/PublicAccount-BasicInterface.html#3582548">2. Re:.net微信公众号开发——基础接口</a></li>
        <li class="recent_comment_body">mark</li>
        <li class="recent_comment_author">--yesorno</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/xrwang/archive/2010/02/05/MatchTemplate.html#3578719">3. Re:模板匹配(Match Template)</a></li>
        <li class="recent_comment_body">博主请问你有这个的源代码吗？有的话，麻烦发一下到我的邮箱1159147833@qq.com，谢谢！</li>
        <li class="recent_comment_author">--zhudada</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/xrwang/archive/2010/03/27/BackgroundGenerationAndForegroundDetectionPhase2.html#3567376">4. Re:背景建模与前景检测之二(Background Generation And Foreground Detection Phase 2)</a></li>
        <li class="recent_comment_body">请问下这个算法实现的源代码有吗？可不可以分享一下？</li>
        <li class="recent_comment_author">--不懂就问的好孩子</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/xrwang/p/PublicAccount-QuickStart.html#3541890">5. Re:.net微信公众号开发——快速入门</a></li>
        <li class="recent_comment_body">有没有人遇到，开启服务器安全狗后回话验证中级模式后，消息返回不了的问题的？<br></li>
        <li class="recent_comment_author">--dfjjfxyl</li>
</ul>
</div>
</div>
</div></div><div id="sidebar_topviewedposts" class="sidebar-block"><div id="topview_posts_wrap">
<div class="catListView">
<h3 class="catListTitle">阅读排行榜</h3>
	<div id="TopViewPostsBlock"><ul><li><a href="http://www.cnblogs.com/xrwang/p/AndroidStudioImportJarAndSoLibrary.html">1. Android Studio开发入门-引用jar及so文件(91646)</a></li><li><a href="http://www.cnblogs.com/xrwang/archive/2010/03/03/ImageFeatureDetection.html">2. 图像特征检测(Image Feature Detection)(53477)</a></li><li><a href="http://www.cnblogs.com/xrwang/archive/2010/02/05/MatchTemplate.html">3. 模板匹配(Match Template)(50768)</a></li><li><a href="http://www.cnblogs.com/xrwang/archive/2010/02/28/ImageSegmentation.html">4. 图像分割(Image Segmentation)(46474)</a></li><li><a href="http://www.cnblogs.com/xrwang/archive/2011/03/09/ransac-1.html">5. 随机抽样一致性算法（RANSAC）(40696)</a></li></ul></div>
</div>
</div></div><div id="sidebar_topcommentedposts" class="sidebar-block"><div id="topfeedback_posts_wrap">
<div class="catListFeedback">
<h3 class="catListTitle">评论排行榜</h3>
	<div id="TopFeedbackPostsBlock"><ul><li><a href="http://www.cnblogs.com/xrwang/archive/2010/03/03/ImageFeatureDetection.html">1. 图像特征检测(Image Feature Detection)(108)</a></li><li><a href="http://www.cnblogs.com/xrwang/archive/2010/02/21/ForegroundDetection.html">2. 背景建模与前景检测(Background Generation And Foreground Detection)(61)</a></li><li><a href="http://www.cnblogs.com/xrwang/archive/2010/02/04/HowToUseHistogram.html">3. 颜色直方图的计算、显示、处理、对比及反向投影(How to Use Histogram? Calculate, Show, Process, Compare and BackProject)(58)</a></li><li><a href="http://www.cnblogs.com/xrwang/archive/2010/12/20/SourceCode.html">4. 源代码下载(53)</a></li><li><a href="http://www.cnblogs.com/xrwang/archive/2010/04/27/GrabCut.html">5. OpenCV(EmguCV)2.1新特性介绍之图像分割GrabCut(GrabCut Of OpenCV 2.1)(51)</a></li></ul></div>
</div>
</div></div><div id="sidebar_topdiggedposts" class="sidebar-block"><div id="topdigg_posts_wrap">
<div class="catListView">
<h3 class="catListTitle">推荐排行榜</h3>
<div id="TopDiggPostsBlock"><ul><li><a href="http://www.cnblogs.com/xrwang/archive/2010/03/03/ImageFeatureDetection.html">1. 图像特征检测(Image Feature Detection)(29)</a></li><li><a href="http://www.cnblogs.com/xrwang/archive/2010/02/21/ForegroundDetection.html">2. 背景建模与前景检测(Background Generation And Foreground Detection)(19)</a></li><li><a href="http://www.cnblogs.com/xrwang/archive/2010/02/09/HowToUseContour.html">3. 轮廓的查找、表达、绘制、特性及匹配(How to Use Contour? Find, Component, Construct, Features &amp; Match)(15)</a></li><li><a href="http://www.cnblogs.com/xrwang/archive/2010/01/26/TheComparisonOfImageProcessingLibraries.html">4. 各种图像处理类库的比较及选择(The Comparison of Image Processing Libraries)(15)</a></li><li><a href="http://www.cnblogs.com/xrwang/p/PublicAccount-QuickStart.html">5. .net微信公众号开发——快速入门(14)</a></li></ul></div>
</div></div></div></div><script type="text/javascript">loadBlogSideColumn();</script>
			</div>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		
<!--done-->
Copyright ©2017 Wuya
	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->


</body></html>